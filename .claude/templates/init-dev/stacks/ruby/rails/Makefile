# DOH Rails Development Makefile  
# Generated by /doh:init-dev for Rails stack
# =================================================================

# Framework identification (required for shared Makefile.common)
FRAMEWORK_NAME = Rails
FRAMEWORK_EMOJI = ğŸ’
DATABASE_NAME = {{DATABASE}}
FRONTEND_NAME = {{FRONTEND}}
FRAMEWORK_INIT = rails-new
HTTPS_PORT = {{HTTPS_PORT}}
TRAEFIK_PORT = {{TRAEFIK_PORT}}
DB_ADMIN = {{DB_ADMIN}}

# Include shared variables and targets
include {{CONTAINER_DIR}}/Makefile.common

# Rails-specific commands - Real Rails CLI (using EXEC for persistent containers)
# Keep only frequently used variables (5+ uses)
RAILS_CLI = ${EXEC_CONTAINER} ${APP_CONTAINER} rails

# Rails-specific PHONY targets (common ones are in Makefile.common)
.PHONY: rails-new rails-console rails-migrate rails-seed rails-generate hello-doh dev-setup

help: ## Show Rails development commands
	$(call help_header)
	$(call help_footer)

# Rails Project Initialization
rails-new: ## Create Rails project with Rails CLI
	@echo "ğŸ’ Creating new Rails project..."
	@echo "ğŸ“‹ Command: $(RAILS_CLI) new {{PROJECT_NAME}} --database={{DATABASE}} --skip-git"
	@$(RAILS_CLI) new {{PROJECT_NAME}} --database={{DATABASE}} --skip-git
	@echo "ğŸ“‹ Command: ${EXEC_CONTAINER} ${APP_CONTAINER} bundle install"
	@${EXEC_CONTAINER} ${APP_CONTAINER} bundle install
	@echo "âœ… Rails project '{{PROJECT_NAME}}' created!"

# Rails Commands
rails-console: ## Open Rails console
	@echo "ğŸ“‹ Command: $(RAILS_CLI) console"
	@$(RAILS_CLI) console

rails-migrate: ## Run Rails migrations
	@echo "ğŸ“‹ Command: $(RAILS_CLI) db:migrate"
	@$(RAILS_CLI) db:migrate

rails-seed: ## Run Rails seeds
	@echo "ğŸ“‹ Command: $(RAILS_CLI) db:seed"
	@$(RAILS_CLI) db:seed

# Rails Generators
rails-generate: ## Run Rails generator (interactive)
	@echo "ğŸ“‹ Command: $(RAILS_CLI) generate"
	@$(RAILS_CLI) generate

hello-doh: ## Rails Hello World + DOH validation + CLI task
	@echo "ğŸ’ Creating Rails Hello World..."
	@echo "ğŸ“‹ Command: $(RAILS_CLI) generate controller Hello index"
	@$(RAILS_CLI) generate controller Hello index
	@echo "ğŸ“‹ Command: $(RAILS_CLI) generate task hello greet"
	@$(RAILS_CLI) generate task hello greet
	@echo "ğŸ¤– AI will generate: HelloController and hello:greet rake task"
	@echo "ğŸ¯ DOH_HELLOWORLD validation included in web view and rake task"

# =================================================================
# DEPENDENCY MANAGEMENT
# =================================================================

dev-setup: ## Install Rails dependencies (bundle + npm)
	@echo "ğŸ’ Installing Rails dependencies..."
	@echo "ğŸ“‹ Command: ${EXEC_CONTAINER} ${APP_CONTAINER} bundle install"
	@${EXEC_CONTAINER} ${APP_CONTAINER} bundle install
	@echo "ğŸ“‹ Command: ${EXEC_CONTAINER} ${APP_CONTAINER} npm install"
	# âš ï¸ Kitchen AI: Remove this line if no Stimulus/webpack/frontend needed
	# âš ï¸ Kitchen AI: Replace with yarn/pnpm if detected or chosen
	@${EXEC_CONTAINER} ${APP_CONTAINER} npm install
	@echo "âœ… Rails dependencies installed!"

bundle-install: ## Install Ruby/Rails dependencies
	@echo "ğŸ“¦ Installing Ruby dependencies..."
	@echo "ğŸ“‹ Command: ${EXEC_CONTAINER} ${APP_CONTAINER} bundle install"
	@${EXEC_CONTAINER} ${APP_CONTAINER} bundle install