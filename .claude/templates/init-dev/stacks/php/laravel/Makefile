# DOH Laravel Development Makefile
# Generated by /doh:init-dev for Laravel stack
# =================================================================

# Framework identification (required for shared Makefile.common)
FRAMEWORK_NAME = Laravel
FRAMEWORK_EMOJI = ğŸ¸
DATABASE_NAME = {{DATABASE}}
FRONTEND_NAME = {{FRONTEND}}
FRAMEWORK_INIT = laravel-new
HTTPS_PORT = {{HTTPS_PORT}}
TRAEFIK_PORT = {{TRAEFIK_PORT}}
DB_ADMIN = {{DB_ADMIN}}

# Include shared variables and targets
include {{CONTAINER_DIR}}/Makefile.common

# Laravel-specific commands - Real Laravel/Artisan CLI (using EXEC for persistent containers)
# Keep only frequently used variables (5+ uses)
ARTISAN = ${EXEC_CONTAINER} ${APP_CONTAINER} php artisan

# Laravel-specific PHONY targets (common ones are in Makefile.common)
.PHONY: laravel-new artisan laravel-migrate laravel-seed laravel-tinker
.PHONY: make-controller make-model make-migration hello-doh dev-setup

help: ## Show Laravel development commands
	$(call help_header)
	$(call help_footer)

# Laravel Project Initialization
laravel-new: ## Create Laravel project with Composer
	@echo "ğŸ¸ Creating new Laravel project..."
	@echo "ğŸ“‹ Command: ${EXEC_CONTAINER} ${APP_CONTAINER} composer create-project laravel/laravel {{PROJECT_NAME}} ."
	@${EXEC_CONTAINER} ${APP_CONTAINER} composer create-project laravel/laravel {{PROJECT_NAME}} .
	@echo "ğŸ“‹ Command: $(ARTISAN) key:generate"
	@$(ARTISAN) key:generate
	@echo "âœ… Laravel project '{{PROJECT_NAME}}' created!"

# Laravel Artisan Commands  
artisan: ## Run Laravel Artisan command (interactive)
	@echo "ğŸ“‹ Command: $(ARTISAN)"
	@$(ARTISAN)

laravel-migrate: ## Run Laravel migrations
	@echo "ğŸ“‹ Command: $(ARTISAN) migrate"
	@$(ARTISAN) migrate

laravel-seed: ## Run Laravel seeders
	@echo "ğŸ“‹ Command: $(ARTISAN) db:seed"
	@$(ARTISAN) db:seed

laravel-tinker: ## Open Laravel Tinker (REPL)
	@echo "ğŸ“‹ Command: $(ARTISAN) tinker"
	@$(ARTISAN) tinker

# Laravel Make Commands
make-controller: ## Create Laravel controller
	@echo "ğŸ“‹ Command: $(ARTISAN) make:controller"
	@$(ARTISAN) make:controller

make-model: ## Create Laravel model
	@echo "ğŸ“‹ Command: $(ARTISAN) make:model"
	@$(ARTISAN) make:model

make-migration: ## Create Laravel migration
	@echo "ğŸ“‹ Command: $(ARTISAN) make:migration"
	@$(ARTISAN) make:migration

hello-doh: ## Laravel Hello World + DOH validation + CLI command
	@echo "ğŸ¸ Creating Laravel Hello World..."
	@echo "ğŸ“‹ Command: $(ARTISAN) make:controller HelloController"
	@$(ARTISAN) make:controller HelloController
	@echo "ğŸ“‹ Command: $(ARTISAN) make:command HelloCommand"
	@$(ARTISAN) make:command HelloCommand
	@echo "ğŸ¤– AI will generate: HelloController route and HelloCommand CLI"
	@echo "ğŸ¯ DOH_HELLOWORLD validation included in web route and artisan command"

# =================================================================
# DEPENDENCY MANAGEMENT
# =================================================================

dev-setup: ## Install Laravel dependencies (composer + npm)
	@echo "ğŸ¸ Installing Laravel dependencies..."
	@echo "ğŸ“‹ Command: ${EXEC_CONTAINER} ${APP_CONTAINER} composer install"
	@${EXEC_CONTAINER} ${APP_CONTAINER} composer install
	@echo "ğŸ“‹ Command: ${EXEC_CONTAINER} ${APP_CONTAINER} npm install"
	# âš ï¸ Kitchen AI: Remove this line if no Vite/webpack/frontend needed
	# âš ï¸ Kitchen AI: Replace with yarn/pnpm if detected or chosen
	@${EXEC_CONTAINER} ${APP_CONTAINER} npm install
	@echo "âœ… Laravel dependencies installed!"

composer-install: ## Install Composer dependencies
	@echo "ğŸ“¦ Installing Composer dependencies..."
	@echo "ğŸ“‹ Command: ${EXEC_CONTAINER} ${APP_CONTAINER} composer install"
	@${EXEC_CONTAINER} ${APP_CONTAINER} composer install