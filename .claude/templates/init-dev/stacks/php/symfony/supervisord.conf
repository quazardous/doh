# Supervisord configuration for Symfony stack
# @AI-Kitchen: COPY to /app/docker/app/supervisord.conf during generation

[supervisord]
nodaemon=true
user=appuser
logfile=/app/var/log/app/supervisord.log
pidfile=/app/var/tmp/supervisord.pid

[unix_http_server]
file=/app/var/tmp/supervisor.sock
chmod=0700
chown=appuser:appgroup

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///app/var/tmp/supervisor.sock

# Web Server Group - Nginx + PHP-FPM for Symfony
[group:web]
programs=nginx,php-fpm

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;" -c /app/docker/app/nginx.conf
autostart=true
autorestart=true
user=appuser
stdout_logfile=/app/var/log/app/nginx.log
stderr_logfile=/app/var/log/app/nginx.log

[program:php-fpm]
command=/usr/local/sbin/php-fpm -F
autostart=true
autorestart=true
user=appuser
stdout_logfile=/app/var/log/app/php-fpm.log
stderr_logfile=/app/var/log/app/php-fpm.log

# Frontend Group - Vue.js development server (Webpack Encore)
[group:frontend]
programs=vue-dev

[program:vue-dev]
command=yarn dev
directory=/app
autostart=false
autorestart=true
user=appuser
environment=NODE_ENV="development"
stdout_logfile=/app/var/log/app/vue-dev.log
stderr_logfile=/app/var/log/app/vue-dev.log

# Optional: Symfony Messenger workers (if async processing needed)
[group:workers]
programs=messenger-worker

[program:messenger-worker]
command=php bin/console messenger:consume async --limit=100
directory=/app
autostart=false
autorestart=true
user=appuser
numprocs=2
stdout_logfile=/app/var/log/app/messenger-worker.log
stderr_logfile=/app/var/log/app/messenger-worker.log