---
name: "Create /doh:prd-evo command implementation"
epic: prd-committee
status: pending
created: 2025-09-06T14:30:00Z
parallel: false
dependencies: [001, 002, 003, 004, 005, 006, 007, 008, 009]
size: L
estimate: 3-4 days
---

# Task 011: Create /doh:prd-evo Command Implementation

## Objective
Implement the `/doh:prd-evo` command that integrates all committee components (4 specialized agents + CTO + orchestrator) into a complete user-facing workflow.

## Background
The specification for `/doh:prd-evo` exists in `.claude/commands/doh/prd-evo.md` but the actual command implementation is missing. This task creates the working command that delivers the full multi-agent committee experience.

## Requirements

### Functional Requirements
- **FR1**: Complete `/doh:prd-evo` command matching specification in `.claude/commands/doh/prd-evo.md`
- **FR2**: Context gathering phase identical to `/doh:prd-new` (discovery, parameter synthesis)
- **FR3**: Orchestrator handoff with complete context package
- **FR4**: Committee session management (4 agents + CTO, 2 rounds, scoring)
- **FR5**: Final PRD creation using existing helper scripts
- **FR6**: Session historization in `.claude/committees/{feature}/` structure
- **FR7**: Convergence vs divergence handling with user decision prompts

### Technical Requirements
- **TR1**: Integration with existing DOH command infrastructure
- **TR2**: Compatibility with `/doh:prd-parse` and epic workflows
- **TR3**: Same PRD output format as `/doh:prd-new`
- **TR4**: Proper error handling and graceful fallback to solo mode
- **TR5**: Progress visualization during 15-minute committee process

### Dependencies
**Must be completed first:**
- Task 001: DevOps Architect agent implementation
- Task 002: Lead Developer agent implementation  
- Task 003: UX Designer agent implementation
- Task 004: Product Owner agent implementation
- Task 005: 2-round workflow with cross-rating system
- Task 006: Convergence algorithm and consensus detection
- Task 007: CTO agent with arbitration capabilities
- Task 008: Committee session file structure design
- Task 009: Orchestrator agent for session management

## Implementation Details

### Phase 1: Context Integration (Day 1)
- **Context gathering**: Reuse `/doh:prd-new` discovery logic (steps 1-4)
- **Parameter synthesis**: Feature name, description, version analysis
- **Committee presentation**: Show workflow preview and get user confirmation
- **Context packaging**: Prepare complete context for orchestrator handoff

### Phase 2: Orchestrator Integration (Day 2)
- **Agent handoff**: Launch parallel-worker agent with committee management
- **Progress monitoring**: Real-time updates during committee session
- **Session workspace**: Create and manage `.claude/committees/{feature}/` structure
- **Error handling**: Graceful fallback and session preservation

### Phase 3: Committee Session Management (Day 3)
- **Session coordination**: Interface with orchestrator for 2-round process
- **Result processing**: Handle consensus vs divergence scenarios
- **User decision interface**: Present options when agents can't converge
- **Final PRD creation**: Use helper scripts for actual file creation

### Phase 4: Integration & Testing (Day 4)
- **Command registration**: Integrate with DOH command system
- **End-to-end testing**: Full workflow from context to final PRD
- **Compatibility validation**: Ensure output works with `/doh:prd-parse`
- **Error scenario testing**: Timeout, failures, edge cases

## Acceptance Criteria

### Primary Success Criteria
- [ ] `/doh:prd-evo feature-name` command works end-to-end
- [ ] Context gathering phase matches `/doh:prd-new` quality
- [ ] Committee session produces valid PRD with proper agent collaboration
- [ ] Session historization captures complete audit trail
- [ ] Convergence algorithm correctly detects consensus vs divergence
- [ ] Final PRD format identical to `/doh:prd-new` output
- [ ] Integration with existing DOH workflows (parse, edit, list)

### Quality Criteria
- [ ] 15-minute total duration (vs 5 min solo) achieved
- [ ] User experience clear and informative throughout process
- [ ] Error messages helpful and actionable
- [ ] Session minutes provide valuable insights into agent decisions
- [ ] Fallback to solo mode works seamlessly when needed

### Technical Criteria
- [ ] Command follows DOH command patterns and conventions
- [ ] Proper parameter validation and error handling
- [ ] Memory and resource usage within acceptable bounds
- [ ] Session files created with proper permissions and structure
- [ ] Compatible with existing test framework

## Testing Strategy

### Unit Tests
- Context gathering and parameter synthesis
- Orchestrator handoff and context packaging
- Result processing (consensus and divergence scenarios)
- Error handling and fallback mechanisms

### Integration Tests  
- Full `/doh:prd-evo` workflow from start to finish
- Compatibility with existing DOH commands
- Session workspace creation and cleanup
- Agent interaction coordination

### User Acceptance Tests
- Real PRD creation scenarios with different complexity levels
- User decision making during divergence situations
- Session minutes quality and usefulness validation
- Performance benchmarking against solo PRD creation

## Deliverables

1. **Command Implementation**: Working `/doh:prd-evo` command
2. **Integration Code**: DOH command system integration
3. **Error Handling**: Comprehensive error scenarios and fallbacks
4. **Test Suite**: Unit, integration, and acceptance tests
5. **Documentation**: User guide and troubleshooting
6. **Session Templates**: Standard file structure for committee workspaces

## Risk Mitigation

| Risk | Impact | Mitigation |
|------|--------|------------|
| Orchestrator integration complexity | High | Build and test orchestrator interface separately first |
| Committee session timeout/hangs | Medium | Implement robust timeout mechanisms and progress monitoring |
| Context handoff data loss | High | Comprehensive validation and error recovery |
| User confusion during divergence | Medium | Clear interface design and multiple testing scenarios |
| Performance degradation | Low | Benchmark and optimize critical paths |

## Success Metrics

- **Functionality**: 100% of acceptance criteria met
- **Performance**: ≤ 20 minutes total duration (stretch goal: ≤ 15 minutes)
- **Quality**: Generated PRDs pass same validation as solo PRDs
- **Usability**: Users can complete workflow without assistance
- **Reliability**: < 5% failure rate in normal usage scenarios

## Notes

This task represents the culmination of the entire prd-committee epic - it's where all individual components come together into a working user experience. Success here validates the entire multi-agent committee approach and enables broader adoption across DOH workflows.

The implementation must prioritize user experience and reliability, as this will be users' first exposure to the committee workflow concept.