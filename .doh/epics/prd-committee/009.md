---
name: "Create orchestrator agent for committee management"
epic: prd-committee
status: pending
created: 2025-08-31T00:34:44Z
updated: "2025-09-06T14:45:00Z"
parallel: false
dependencies: [005, 006, 007, 008]
size: M
estimate: 2-3 days
---

# Task 009: Create orchestrator agent for committee management

## Objective
Create a specialized orchestrator agent that coordinates the multi-agent committee process, managing the 4 specialized agents (DevOps, Lead Dev, UX, PO) plus CTO through the 2-round workflow with proper session management and convergence handling.

## Background
The multi-agent committee system requires sophisticated coordination between 4 specialized agents plus CTO through a 2-round process. This orchestrator agent serves as the master coordinator that manages agent lifecycles, session flow, scoring collection, and convergence detection - bridging the gap between the `/doh:prd-evo` command interface and the actual committee session execution.

## Scope

### In Scope
- Modify `/doh:prd-new` command interface to support committee mode
- Implement committee mode as the new default behavior
- Add `--solo` opt-out flag with reason requirement for tracking
- Integrate with 4-agent committee system and session orchestrator
- Preserve all existing command arguments and functionality
- Implement graceful fallback to solo mode on committee failures
- Add progress indication and user feedback during committee sessions
- Ensure output format compatibility with existing DOH workflows

### Out of Scope
- Modification of other DOH commands (handled in separate tasks)
- Advanced committee configuration options (future enhancement)
- Real-time collaboration features or UI changes
- Integration with external project management tools

## Technical Requirements

### Command Interface Design
```bash
# New default: Committee mode (no flag required)
/doh:prd-new feature-name "Feature description"

# Explicit committee mode (optional)
/doh:prd-new feature-name "Feature description" --committee

# Solo mode opt-out (with required reason tracking)
/doh:prd-new feature-name "Feature description" --solo --reason "simple CRUD operation"

# Existing arguments preserved
/doh:prd-new feature-name "Feature description" --output custom-path --template custom
```

### Committee Integration Points
1. **Agent Orchestration**: Interface with 4 specialized agents (005, 006, 007)
2. **Session Management**: Integration with session orchestrator and file structure (008)
3. **Progress Tracking**: Real-time feedback during 2-round committee process
4. **Convergence Detection**: Integration with convergence analysis and CTO escalation
5. **Output Generation**: Consistent PRD format regardless of committee vs solo mode

## Implementation Details

### Phase 1: Command Interface Extension (Day 1)
1. **Argument Parser Enhancement**
   ```typescript
   interface PRDNewOptions {
     featureName: string
     description: string
     mode: 'committee' | 'solo'
     soloReason?: string
     output?: string
     template?: string
     // Preserve all existing options
   }
   ```

2. **Mode Detection Logic**
   - Default to committee mode when no mode specified
   - Validate `--solo` requires `--reason` parameter
   - Implement reason logging for solo mode usage tracking
   - Add validation for committee mode prerequisites

3. **Backward Compatibility Layer**
   - Preserve all existing command signatures
   - Maintain identical output format and file locations
   - Ensure existing scripts and integrations continue working
   - Add migration guides for teams transitioning to committee mode

### Phase 2: Committee Mode Implementation (Day 2)
1. **Committee Orchestrator Integration**
   ```typescript
   class PRDCommitteeOrchestrator {
     async runCommitteeSession(options: PRDNewOptions): Promise<PRDResult> {
       const session = await this.sessionManager.createSession(options.featureName)
       const round1Results = await this.runRound1(session)
       const round2Results = await this.runRound2(session, round1Results)
       return await this.finalizeSession(session, round2Results)
     }
   }
   ```

2. **Progress Indication System**
   - Real-time progress display during committee rounds
   - Agent status updates and draft completion indicators
   - Rating collection and convergence analysis progress
   - Estimated time remaining and current phase indication

3. **Error Handling and Fallback**
   - Graceful degradation to solo mode on committee failures
   - Comprehensive error logging and recovery mechanisms
   - User notification of fallback scenarios with explanations
   - Partial session recovery and continuation options

### Phase 3: Integration and Validation (Day 3)
1. **Solo Mode Preservation**
   - Maintain existing solo mode functionality unchanged
   - Ensure solo mode performance and reliability
   - Add solo mode usage analytics for team insights
   - Implement solo mode bypass for emergency situations

2. **Output Format Consistency**
   - Ensure committee and solo mode produce identical file formats
   - Validate compatibility with downstream DOH commands
   - Test integration with existing PRD parsing and epic workflows
   - Maintain metadata consistency across both modes

3. **Performance Optimization**
   - Optimize committee mode startup and initialization
   - Implement timeout handling for long committee sessions
   - Add caching for agent initialization and common operations
   - Ensure acceptable performance compared to solo mode

## User Experience Design

### Committee Mode Experience
```bash
$ /doh:prd-new user-auth "Multi-tenant authentication system"

🏛️  Starting PRD Committee Session...
👥  Initializing 4 specialized agents (DevOps, Lead Dev, UX, PO)
📝  Round 1: Collecting initial drafts...
   ├── 🏗️  DevOps: Infrastructure perspective... ✅
   ├── 💻  Lead Dev: Technical architecture... ✅  
   ├── 🎨  UX: User experience design... ✅
   └── 💼  PO: Business requirements... ✅

📊  Analyzing convergence... (Score: 0.65/0.80)
📝  Round 2: Refining based on cross-ratings...
   ├── 🏗️  DevOps: Addressing UX concerns... ✅
   ├── 💻  Lead Dev: Incorporating DevOps feedback... ✅
   ├── 🎨  UX: Technical feasibility adjustments... ✅
   └── 💼  PO: Balancing scope and timeline... ✅

✨  Convergence achieved! (Score: 0.83/0.80)
📄  Final PRD generated: .doh/prds/user-auth.md
🏛️  Committee session completed in 8 minutes

Next: Run '/doh:prd-parse user-auth' to create implementation epic
```

### Solo Mode Experience (Preserved)
```bash
$ /doh:prd-new user-auth "Multi-tenant authentication system" --solo --reason "emergency hotfix"

⚡  Solo mode: Generating PRD quickly...
📄  PRD generated: .doh/prds/user-auth.md
⚡  Solo mode completed in 2 minutes

Next: Run '/doh:prd-parse user-auth' to create implementation epic
```

## Integration Points

### Agent System Integration
- Seamless interface with DevOps, Lead Dev, UX, and PO agents
- Agent state management and lifecycle control
- Error handling for individual agent failures
- Agent performance monitoring and optimization

### Session Management Integration
- Integration with committee session file structure system
- Session recovery and continuation mechanisms
- Audit trail preservation and session historization
- Metadata tracking and session analytics

### DOH Ecosystem Integration
- Maintain compatibility with `/doh:prd-parse` and epic workflows
- Ensure consistent file formats and metadata structures
- Integrate with existing DOH configuration and environment
- Preserve existing command aliases and shortcuts

## Acceptance Criteria

### Functional Requirements
- [ ] Committee mode works as default without flags
- [ ] Solo mode accessible with `--solo --reason` flags
- [ ] All existing command arguments preserved and functional
- [ ] Committee session completes successfully with valid PRD output
- [ ] Progress indication provides clear status during committee rounds
- [ ] Error handling gracefully falls back to solo mode when needed
- [ ] Output format identical between committee and solo modes
- [ ] Integration works with existing DOH command workflows

### Backward Compatibility Requirements
- [ ] Existing scripts using `/doh:prd-new` continue working
- [ ] Command performance acceptable (committee < 15 min, solo < 3 min)
- [ ] File output locations and naming conventions preserved
- [ ] Metadata format compatible with existing parsers
- [ ] All existing command options and flags functional
- [ ] Help documentation updated but legacy usage supported

### Quality Requirements
- [ ] Unit tests cover both committee and solo mode paths
- [ ] Integration tests validate end-to-end committee workflow
- [ ] Error handling tested for various failure scenarios
- [ ] Performance tests ensure acceptable timing for both modes
- [ ] User experience tested for clarity and usability
- [ ] Documentation updated with new usage patterns

## Definition of Done
- [ ] `/doh:prd-new` command modified to support committee mode by default
- [ ] Solo mode opt-out mechanism implemented with reason tracking
- [ ] Committee orchestration integrated and functional
- [ ] Progress indication system provides clear user feedback
- [ ] Error handling and fallback mechanisms validated
- [ ] Backward compatibility verified with existing usage patterns
- [ ] Performance meets requirements for both modes
- [ ] Integration tests pass for complete workflow
- [ ] Documentation updated with new command interface
