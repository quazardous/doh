---
id: 004
title: Add maintenance epic auto-creation for completed epics
status: pending
created: 2025-08-31T15:01:00Z
priority: medium
estimate: 6 hours
epic: quick-epic
depends_on: [001, 002]
---

# Task 004: Add maintenance epic auto-creation for completed epics

## Overview

Implement automatic creation of `maintenance.md` files when quick tasks are matched to completed epics. This enables ongoing technical maintenance without violating the immutability of completed epic.md files.

## Requirements

### Functional Requirements

#### Completed Epic Detection
- Check epic status in frontmatter (`status: completed`)
- Validate that epic.md should not be modified
- Trigger maintenance epic creation workflow
- Handle edge cases (missing status, corrupted files)

#### Maintenance Epic Creation
- Auto-create `maintenance.md` file in same epic directory
- Use full epic structure with proper frontmatter
- Continue task numbering sequence from original epic
- Link to parent epic with `parent_epic` field

#### Scope Validation
- **Allowed**: Bugs, performance improvements, security fixes, refactoring
- **Forbidden**: New features, requirement changes, scope expansion
- Present scope validation to user before creation
- Provide clear guidelines on maintenance vs feature work

#### Task Integration
- Create maintenance tasks with sequential numbering (004, 005, 006...)
- Never modify original epic.md file
- Maintain separate maintenance epic status
- Support ongoing maintenance work

### Technical Requirements

#### File Operations
- Detect existence of maintenance.md file
- Create new maintenance epic if doesn't exist
- Append tasks to existing maintenance epic
- Preserve all original files

#### Frontmatter Structure
```yaml
---
name: feature-name-maintenance
parent_epic: feature-name
type: maintenance
status: active
created: 2025-08-31T15:01:00Z
progress: 0%
scope: "Technical maintenance only - no new features"
---
```

#### Validation Logic
- Parse task description for feature vs maintenance keywords
- Warn user if task appears to be new feature work
- Provide guidance on proper scope boundaries
- Allow override with explicit confirmation

## Implementation Details

### Workflow
1. **Epic Status Check**: Verify original epic is completed
2. **Maintenance Epic Setup**: Create or locate maintenance.md
3. **Scope Validation**: Analyze task description for appropriateness
4. **Task Creation**: Add task with proper numbering
5. **Integrity Check**: Ensure original epic untouched

### File Structure
```bash
.claude/scripts/doh/lib/
├── maintenance-epic.sh      # Core maintenance epic logic
└── scope-validator.sh       # Feature vs maintenance detection
```

### Key Functions
- `is_epic_completed(epic_dir)` - Check completion status
- `create_maintenance_epic(epic_dir, parent_name)` - Initialize maintenance.md
- `validate_maintenance_scope(task_description)` - Check scope appropriateness
- `get_next_maintenance_task_number(epic_dir)` - Continue numbering sequence
- `add_maintenance_task(epic_dir, task_details)` - Create task file

### Maintenance Epic Template
```markdown
# Epic: feature-name-maintenance

## Overview
Technical maintenance and improvements for the completed feature-name epic.

## Scope
- Bug fixes and issue resolution
- Performance optimizations  
- Security improvements
- Code refactoring and cleanup
- **NO new features or requirement changes**

## Parent Epic
This is a maintenance epic for `.doh/epics/feature-name/epic.md` which completed on [date].
```

### Dependencies
- Task 001: Matching algorithm identifies completed epics
- Task 002: User selection triggers maintenance workflow
- Existing frontmatter.sh for file parsing
- DOH file structure conventions

## Testing Strategy

### Test Scenarios
1. **First Maintenance Task**: Create maintenance.md for first time
2. **Existing Maintenance**: Add task to existing maintenance epic
3. **Scope Validation**: Test feature vs maintenance detection
4. **Edge Cases**: Missing parent epic, corrupted files
5. **Numbering**: Verify proper task sequence continuation

### Validation Testing
- Test scope validator with various task descriptions
- Ensure feature requests are flagged appropriately
- Validate maintenance tasks are accepted
- Test user override functionality

## Acceptance Criteria

- [ ] Completed epic detection works reliably
- [ ] Maintenance.md creation uses proper template and frontmatter
- [ ] Task numbering continues from parent epic sequence
- [ ] Scope validation provides appropriate warnings
- [ ] Original epic.md files never modified
- [ ] Multiple maintenance tasks can be added to same epic
- [ ] Integration with matching workflow seamless
- [ ] User guidance clear on maintenance vs feature boundaries

## Definition of Done

- Maintenance epic creation logic implemented
- Scope validation prevents inappropriate feature additions
- Task numbering sequence properly maintained
- Integration with quick task workflow complete
- File operations preserve epic integrity
- User experience provides clear guidance on scope boundaries