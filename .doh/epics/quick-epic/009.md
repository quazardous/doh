---
name: Patch version bump detection - hotfix and maintenance tasks
number: 009
status: open
created: 2025-09-01T23:10:00Z
updated: 2025-09-01T23:15:00Z
github: [Will be updated when synced to GitHub]
epic: quick-epic
depends_on: [004]
parallel: false
conflicts_with: []
file_version: 0.5.0
target_version: 0.6.0
---

# Task 009: Patch version bump detection - hotfix and maintenance tasks

## Description
Enhance the AI analysis in `/doh:version-bump --analyze` to properly detect and categorize maintenance and hotfix tasks that warrant patch-level version bumps. This task complements the maintenance epic system (Task 004) by providing intelligent detection of tasks that should trigger patch releases instead of minor/major versions.

## Acceptance Criteria
- [ ] Define task patterns that indicate patch-level changes
- [ ] Implement hotfix task detection (urgent bug fixes)
- [ ] Implement maintenance task detection (refactoring, cleanup, dependencies)
- [ ] Add security patch detection and prioritization
- [ ] Create task categorization logic for patch vs minor/major
- [ ] Integrate with existing version-bump analysis system
- [ ] Add configuration for patch detection sensitivity
- [ ] Document patch detection rules and examples

## Technical Details

### Patch-Level Task Patterns

#### 1. **Hotfix Tasks** (Critical patch indicators)
```yaml
# Task frontmatter patterns
priority: critical|urgent|high
type: hotfix|bugfix|security
tags: [hotfix, urgent, security, critical]
status: completed
```

#### 2. **Maintenance Tasks** (Non-feature patch indicators)
```yaml
# Task patterns
type: maintenance|refactor|cleanup|dependency
tags: [maintenance, refactor, cleanup, deps, chore]
name: # Contains keywords: "fix", "update", "upgrade", "clean", "refactor"
```

#### 3. **Bug Fix Detection**
```yaml
# Task identification patterns
name: # Starts with "Fix", "Resolve", "Patch", "Correct"
description: # Contains bug-related terms
type: bugfix|fix
```

### Implementation Components

#### 1. **Task Pattern Matcher**
```bash
# Function: detect_patch_tasks()
detect_patch_tasks() {
    local since_version="$1"
    local patch_tasks=()
    
    # Scan completed tasks since last version
    find_completed_tasks_since "$since_version" | while read -r task_file; do
        if is_hotfix_task "$task_file" || 
           is_maintenance_task "$task_file" || 
           is_bugfix_task "$task_file"; then
            patch_tasks+=("$task_file")
        fi
    done
    
    printf '%s\n' "${patch_tasks[@]}"
}
```

#### 2. **Hotfix Detection Logic**
```bash
is_hotfix_task() {
    local task_file="$1"
    
    # Check priority levels
    local priority=$(get_frontmatter_field "$task_file" "priority")
    [[ "$priority" =~ (critical|urgent|high) ]] && return 0
    
    # Check type indicators
    local type=$(get_frontmatter_field "$task_file" "type")
    [[ "$type" =~ (hotfix|security|bugfix) ]] && return 0
    
    # Check tags
    local tags=$(get_frontmatter_field "$task_file" "tags")
    [[ "$tags" =~ (hotfix|urgent|security|critical) ]] && return 0
    
    return 1
}
```

#### 3. **Maintenance Task Detection**
```bash
is_maintenance_task() {
    local task_file="$1"
    local task_name task_desc task_type
    
    task_name=$(get_frontmatter_field "$task_file" "name")
    task_desc=$(get_frontmatter_field "$task_file" "description") 
    task_type=$(get_frontmatter_field "$task_file" "type")
    
    # Type-based detection
    [[ "$task_type" =~ (maintenance|refactor|cleanup|dependency|chore) ]] && return 0
    
    # Name-based patterns
    [[ "$task_name" =~ ^(Update|Upgrade|Clean|Refactor|Optimize) ]] && return 0
    [[ "$task_name" =~ (dependencies|cleanup|maintenance) ]] && return 0
    
    # Description-based patterns
    [[ "$task_desc" =~ (refactor|cleanup|maintenance|dependency update) ]] && return 0
    
    return 1
}
```

#### 4. **Bug Fix Detection**
```bash
is_bugfix_task() {
    local task_file="$1"
    local task_name task_desc task_type
    
    task_name=$(get_frontmatter_field "$task_file" "name")
    task_desc=$(get_frontmatter_field "$task_file" "description")
    task_type=$(get_frontmatter_field "$task_file" "type")
    
    # Type-based detection
    [[ "$task_type" =~ (bugfix|fix|patch) ]] && return 0
    
    # Name-based patterns (case insensitive)
    [[ "$task_name" =~ ^(Fix|Resolve|Patch|Correct) ]] && return 0
    [[ "$task_name" =~ (bug|issue|error|problem) ]] && return 0
    
    # Description analysis for bug indicators
    [[ "$task_desc" =~ (fix.*bug|resolve.*issue|patch.*problem) ]] && return 0
    
    return 1
}
```

### Integration with version-bump Analysis

#### Enhanced AI Analysis Output
```
üîç DOH Version Analysis - Patch Detection
=========================================
Current Version: 0.5.0
Analyzed Period: Since 2025-09-01 (last version)

üö® Hotfix Tasks (2):
  - Task 025: Fix critical authentication bypass [SECURITY]
  - Task 026: Resolve memory leak causing crashes [URGENT]

üîß Maintenance Tasks (3):
  - Task 027: Update dependencies to latest versions
  - Task 028: Refactor logging system for better performance  
  - Task 029: Clean up deprecated configuration options

üêõ Bug Fixes (1):
  - Task 030: Fix date parsing in version validation

‚ú® New Features (0): None detected

üéØ Recommended Bump: PATCH (0.5.0 ‚Üí 0.5.1)
Reason: Only hotfixes, maintenance, and bug fixes - no new features

‚ö° Urgency Assessment: HIGH
- 2 security/critical tasks require immediate release
- Recommend expedited patch release within 24-48 hours

üí° Release Strategy:
1. IMMEDIATE: Release 0.5.1 with hotfixes (Tasks 025, 026)
2. NEXT WEEK: Release 0.5.2 with maintenance updates (Tasks 027-030)
3. FUTURE: Plan 0.6.0 when new features are ready
```

### Configuration Options

#### DOH Environment Settings (`.doh/env`)
```bash
# Patch detection sensitivity
DOH_PATCH_DETECTION=strict|moderate|loose  # default: moderate

# Security patch priority
DOH_SECURITY_PRIORITY=true  # default: true

# Auto-suggest patch for maintenance tasks
DOH_MAINTENANCE_PATCHES=true  # default: false
```

#### Detection Sensitivity Levels
- **strict**: Only explicit hotfix/security tasks trigger patch
- **moderate**: Include bug fixes and critical maintenance  
- **loose**: Include all maintenance and cleanup tasks

### Version Bump Integration

Update `/doh:version-bump --analyze` to:
1. **Scan completed tasks** since last version using pattern matching
2. **Categorize tasks** by patch indicators vs feature indicators
3. **Assess urgency** based on security/critical flags
4. **Recommend appropriate bump level** with detailed reasoning
5. **Suggest release timing** based on task urgency

## Dependencies
- [ ] Enhanced version-bump analysis system (Task 007)
- [ ] Frontmatter library with advanced querying
- [ ] Task completion tracking
- [ ] Configuration system integration

## Effort Estimate
- Size: M
- Hours: 6-8
- Parallel: false (depends on Task 007)

## Definition of Done
- [ ] Patch task detection algorithms implemented
- [ ] Hotfix detection working with priority/type/tags
- [ ] Maintenance task pattern matching functional
- [ ] Bug fix detection with name/description analysis
- [ ] Integration with version-bump analysis complete
- [ ] Configuration options for detection sensitivity
- [ ] Enhanced analysis output with patch categorization
- [ ] Documentation with examples and configuration guide
- [ ] Unit tests for all detection functions
- [ ] Integration tests with real task examples

## Examples

### High-Priority Patch Tasks
```yaml
---
name: Fix critical SQL injection vulnerability
type: security
priority: critical
tags: [security, hotfix, urgent]
status: completed
---
```

### Maintenance Patch Tasks
```yaml
---  
name: Update Node.js dependencies to latest LTS
type: maintenance
tags: [maintenance, dependencies]
status: completed
---
```

### Bug Fix Patch Tasks
```yaml
---
name: Resolve incorrect date formatting in reports
type: bugfix
status: completed  
---
```