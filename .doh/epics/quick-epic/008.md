---
id: 008
title: Implement QUICK task removal functionality (new requirement from user)
status: pending
created: 2025-08-31T15:07:00Z
priority: high
estimate: 4 hours
epic: quick-epic
depends_on: [007]
---

# Task 008: Implement QUICK task removal functionality (new requirement from user)

## Overview

Implement functionality to remove tasks from the QUICK system since it's a never-completing container that will accumulate tasks over time. This addresses the user's requirement for "a way to remove tasks in QUICK" and provides cleanup capabilities for completed, obsolete, or mistakenly created quick tasks.

## Requirements

### Functional Requirements

#### Task Removal Commands
- `/doh:quick --remove QUICK-001` - Remove specific task by ID
- `/doh:quick --remove-completed` - Batch remove all completed tasks
- `/doh:quick --cleanup` - Interactive cleanup with options to remove/archive tasks
- `/doh:quick --list-removable` - Show tasks eligible for removal with rationale

#### Removal Criteria and Safety
- **Completed Tasks**: Safe to remove after configurable retention period (default: 30 days)
- **Obsolete Tasks**: Tasks marked as "wontfix" or "duplicate"
- **Broken Tasks**: Tasks with invalid dependencies or corrupted metadata
- **User Choice**: Allow manual removal of any task with confirmation
- **Safety Checks**: Prevent removal of tasks referenced by dependencies

#### Interactive Cleanup Mode
- Show removable tasks grouped by criteria (completed, old, broken)
- Allow selective removal with checkboxes or numbered selection
- Provide task preview before removal confirmation
- Support bulk operations with "remove all in category"
- Show storage space savings and task count reduction

#### Removal Workflow Options
1. **Permanent Deletion**: Remove task files completely
2. **Archive Mode**: Move tasks to `.doh/quick/archive/` directory
3. **Backup First**: Create backup before removal (configurable)
4. **Dry Run Mode**: Show what would be removed without actual deletion

### Technical Requirements

#### Task Dependency Analysis
- Scan all epics for references to QUICK tasks before removal
- Block removal of tasks that are dependencies for active tasks
- Provide clear error messages when removal is blocked
- Suggest alternatives (complete dependencies first, etc.)

#### File Operations
- Safe file removal with atomic operations
- Backup creation before destructive operations
- Archive directory management and organization
- Cleanup of empty directories after removal

#### Data Integrity
- Update task numbering after removals (optional, configurable)
- Maintain GitHub issue sync consistency
- Update any cross-references in other files
- Preserve audit trail of removals

#### Configuration Options
- Retention period for completed tasks (default 30 days)
- Default removal mode (delete vs archive vs backup)
- Auto-cleanup frequency (manual, weekly, monthly)
- Confirmation requirements for different removal types

## Implementation Details

### Command Line Interface
```bash
# Removal command parsing
parse_removal_args() {
    case "$1" in
        --remove)
            remove_specific_task "$2"
            ;;
        --remove-completed)
            remove_completed_tasks
            ;;
        --cleanup)
            interactive_cleanup_mode
            ;;
        --list-removable)
            list_removable_tasks
            ;;
        *)
            error "Unknown removal option: $1"
            ;;
    esac
}
```

### Task Analysis Functions
```bash
# Analyze task removability
analyze_task_removability() {
    local task_file="$1"
    local task_id="$(get_task_id "$task_file")"
    local status="$(get_task_status "$task_file")"
    local created_date="$(get_task_created_date "$task_file")"
    
    # Check dependency references
    if has_active_dependencies "$task_id"; then
        echo "blocked:Referenced by active tasks"
        return
    fi
    
    # Check completion status and age
    if [[ "$status" == "completed" ]]; then
        local age_days=$(calculate_age_days "$created_date")
        if (( age_days > RETENTION_PERIOD )); then
            echo "removable:Completed task older than $RETENTION_PERIOD days"
        else
            echo "retain:Recently completed (${age_days} days ago)"
        fi
        return
    fi
    
    # Check for obsolete markers
    if [[ "$status" =~ ^(wontfix|duplicate|obsolete)$ ]]; then
        echo "removable:Marked as $status"
        return
    fi
    
    echo "retain:Active task"
}
```

### Interactive Cleanup Interface
```bash
# Interactive cleanup workflow
interactive_cleanup_mode() {
    echo "ðŸ§¹ QUICK System Task Cleanup"
    echo "============================="
    
    local removable_tasks=($(find_removable_tasks))
    
    if [[ ${#removable_tasks[@]} -eq 0 ]]; then
        echo "âœ… No tasks eligible for cleanup"
        return
    fi
    
    echo "Found ${#removable_tasks[@]} tasks eligible for removal:"
    echo
    
    # Group by removal reason
    show_cleanup_categories "${removable_tasks[@]}"
    
    echo "Options:"
    echo "  1) Remove all completed tasks ($(count_completed_removable))"
    echo "  2) Remove all obsolete tasks ($(count_obsolete_removable))"  
    echo "  3) Select individual tasks"
    echo "  4) Remove all eligible tasks"
    echo "  5) Cancel"
    
    read -p "Choose option (1-5): " choice
    process_cleanup_choice "$choice" "${removable_tasks[@]}"
}
```

### Archive Management
```bash
# Archive tasks instead of deleting
archive_task() {
    local task_file="$1"
    local archive_dir=".doh/quick/archive/$(date +%Y-%m)"
    
    mkdir -p "$archive_dir"
    mv "$task_file" "$archive_dir/"
    
    log_removal "archived" "$task_file" "$archive_dir"
    echo "ðŸ“¦ Archived: $(basename "$task_file")"
}
```

### Dependencies
- Task 007: Command integration patterns and QUICK task handling
- Existing DOH file operation libraries
- GitHub sync functionality for issue cleanup
- Frontmatter parsing and task metadata access

## Testing Strategy

### Removal Safety Testing
1. **Dependency Protection**: Test removal blocked when task has active dependencies
2. **Confirmation Flows**: Verify all removal operations require appropriate confirmation
3. **Rollback Capability**: Test backup/archive recovery procedures
4. **Data Integrity**: Ensure removal doesn't corrupt remaining task data

### Interactive Interface Testing
1. **User Flow**: Test complete interactive cleanup workflow
2. **Category Display**: Verify proper grouping and counting of removable tasks
3. **Selection Handling**: Test individual and bulk selection mechanisms
4. **Error Recovery**: Test handling of invalid selections and interrupted flows

### Edge Case Testing
- Remove tasks with circular dependencies
- Cleanup with very large numbers of tasks (1000+)
- Concurrent access during removal operations
- Removal of recently created tasks
- Tasks with special characters in names/descriptions

### Integration Testing
- GitHub issue cleanup when tasks are removed
- Status command accuracy after task removal
- Next command behavior with reduced task set
- System statistics updates after bulk removal

## Acceptance Criteria

- [ ] `/doh:quick --remove TASK-ID` safely removes individual tasks
- [ ] `--remove-completed` batch removes old completed tasks with configurable retention
- [ ] Interactive cleanup mode provides clear categorization and selection
- [ ] Dependency analysis prevents removal of referenced tasks
- [ ] Archive mode preserves removed tasks for potential recovery
- [ ] GitHub sync handles removed task cleanup appropriately
- [ ] All removal operations require appropriate confirmation
- [ ] Performance acceptable even with large numbers of QUICK tasks

## Definition of Done

- Task removal commands implemented and tested
- Interactive cleanup interface functional and user-friendly
- Dependency analysis prevents unsafe removals
- Archive functionality preserves removed tasks
- GitHub integration handles task removal sync
- Safety confirmations prevent accidental data loss
- Performance requirements met for large task sets
- Documentation includes removal workflow guidance