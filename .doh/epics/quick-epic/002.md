---
id: 002
title: Implement interactive selection workflow with user controls
status: pending
created: 2025-08-31T14:59:00Z
priority: high
estimate: 6 hours
epic: quick-epic
depends_on: [001]
---

# Task 002: Implement interactive selection workflow with user controls

## Overview

Create the user interface for selecting PRD matches, navigating options, and controlling the matching workflow. This provides the human decision layer on top of the matching algorithm.

## Requirements

### Functional Requirements

#### Match Display
- Show top matches with percentage scores in descending order
- Display match rationale (which keywords matched)
- Limit initial display to top 5 matches for clarity
- Format: `[85%] feature-auth: Matched 'login', 'session', 'security'`

#### User Navigation Options
1. **Select match**: Type number (1-5) or PRD name to select
2. **Skip to next**: 's' to skip current batch, show next 5 matches  
3. **Type PRD name**: Direct entry for known PRD
4. **Skip all**: 'q' to skip matching entirely, go to QUICK epic
5. **Help**: 'h' to show command options

#### Deep Analysis Trigger
- Only perform deep epic/task analysis when user selects a match
- Show loading indicator during analysis: "Analyzing epic structure..."
- Present synthesized recommendation, not raw data dump

#### Confirmation Flow
- Always confirm before creating or attaching tasks
- Show exactly what will be created/modified
- Allow user to abort at any point

### Technical Requirements

#### Input Handling
- Robust parsing of user input (numbers, names, commands)
- Case-insensitive PRD name matching
- Input validation with clear error messages
- Timeout handling for inactive sessions

#### State Management
- Track current match batch position
- Remember user preferences during session
- Handle interruptions gracefully
- Clean exit on user abort

#### Integration Points
- Receive sorted matches from Task 001 (matching algorithm)
- Call deep analysis functions when match selected
- Interface with task creation system

## Implementation Details

### User Flow
```
1. Display: "Found 12 PRD matches for your task:"
2. Show top 5 with scores and keywords
3. Prompt: "Select (1-5), skip (s), name PRD, or skip all (q): "
4. Process input and either:
   - Perform deep analysis on selected PRD
   - Show next batch of matches
   - Accept direct PRD name entry  
   - Fall back to QUICK epic creation
```

### File Structure
```bash
.claude/scripts/doh/lib/
├── interactive.sh        # User interaction functions
└── display.sh           # Output formatting utilities
```

### Key Functions
- `display_matches(matches_array)` - Format and show PRD matches
- `get_user_selection()` - Handle input parsing and validation
- `show_match_batch(matches, start_index)` - Paginated display
- `confirm_action(description)` - Generic confirmation prompt

### Dependencies
- Task 001: Matching algorithm output format
- Existing DOH command patterns for user interaction
- Standard bash read/input functions

## Testing Strategy

### Interactive Testing
1. **Happy Path**: User selects first match, confirms creation
2. **Navigation**: User skips through multiple batches
3. **Direct Entry**: User types known PRD name
4. **Skip All**: User bypasses matching entirely
5. **Invalid Input**: Test error handling and recovery

### Edge Cases
- Empty match list (no PRDs found)
- Single match vs multiple matches
- Very long PRD names or descriptions
- User interruption (Ctrl+C handling)

### Usability Testing
- Time from command to selection < 30 seconds
- Clear error messages for invalid input
- Intuitive navigation commands

## Acceptance Criteria

- [ ] Match display shows scores and keywords clearly
- [ ] All navigation options (select, skip, direct, skip-all) work correctly
- [ ] Input validation handles edge cases gracefully
- [ ] Deep analysis only triggered when match selected
- [ ] Confirmation flow prevents accidental task creation
- [ ] User can abort process at any point
- [ ] Interface integrates smoothly with matching algorithm output

## Definition of Done

- Interactive workflow functions implemented
- User input handling robust and tested
- Integration with Task 001 matching output working
- Navigation commands functional and intuitive
- Error handling prevents crashes
- Usability requirements met (< 30 second selection time)