---
name: Agent Workspace Integration
status: open
created: 2025-08-31T06:51:25Z
updated: 2025-08-31T06:51:25Z
github: [Will be updated when synced to GitHub]
depends_on: [001, 002, 003]
parallel: false
conflicts_with: []
---

# Task: Agent Workspace Integration

## Description
Update all agents (especially parallel-worker) to be workspace-aware, ensuring they receive and display their working workspace, log to the correct location, and handle worktree operations properly.

## Acceptance Criteria
- [ ] Agents receive full workspace object in their prompts
- [ ] Agents display workspace banner at startup
- [ ] Agent logs stream to correct location
- [ ] Parallel-worker handles worktree paths correctly
- [ ] Agents cannot launch without proper validation

## Technical Details
- **Agents to update**:
  - `parallel-worker.md` - Primary focus
  - All other agent definitions that launch sub-tasks
- **Workspace injection format**:
  ```yaml
  AGENT_WORKSPACE:
    mode: worktree
    directory: ../epic-feature-x/
    branch: epic/feature-x
    log_file: .doh/logs/epic-feature-x/agent-1.log
    commit_prefix: "Issue #123:"
  ```
- **Agent prompt modifications**:
  - Add workspace display requirement
  - Include working directory explicitly
  - Specify commit branch clearly
  - Add log streaming instructions
- **Validation integration**:
  - Pre-flight checks before agent spawn
  - Workspace verification in agent startup

## Dependencies
- [ ] Task 001 (workspace library)
- [ ] Task 002 (command updates for launching agents)
- [ ] Task 003 (validation system)

## Effort Estimate
- Size: M
- Hours: 8 hours
- Parallel: false (depends on multiple prior tasks)

## Definition of Done
- [ ] All agents updated with workspace awareness
- [ ] Agent prompts include full workspace object
- [ ] Agents display workspace banner on startup
- [ ] Logs appear in correct directories
- [ ] Validation prevents invalid agent launches