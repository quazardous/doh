---
name: Pre-flight Validation System
status: open
created: 2025-08-31T06:51:25Z
updated: 2025-08-31T06:51:25Z
github: [Will be updated when synced to GitHub]
depends_on: [001]
parallel: true
conflicts_with: []
---

# Task: Pre-flight Validation System

## Description
Implement comprehensive pre-flight validation checks that prevent agent launches in non-existent worktrees, verify directory structures, and provide clear error messages with remediation steps.

## Acceptance Criteria
- [ ] Pre-flight validation function prevents launches in missing worktrees
- [ ] Clear error messages with specific remediation steps
- [ ] Validation checks worktree existence, branch state, and permissions
- [ ] Rollback mechanism for failed worktree creation
- [ ] Integration points for all agent-launching commands

## Technical Details
- **Implementation approach**: Create validation library with fail-fast checks
- **Key validation functions**:
  - `validate_worktree_exists()` - Check worktree presence
  - `validate_branch_state()` - Verify correct branch
  - `validate_permissions()` - Check write access
  - `validate_agent_workspace()` - Full pre-launch validation
- **Files to create**:
  - `.doh/lib/validation.sh` - Validation functions
  - `.doh/lib/rollback.sh` - Cleanup on failure
- **Error message format**:
  ```
  ‚ùå FAIL: Worktree not found at ../epic-feature-x/
     Fix: Run /doh:epic-start feature-x
  ```

## Dependencies
- [ ] Task 001 (workspace library for detection)
- [ ] No external dependencies

## Effort Estimate
- Size: M
- Hours: 8 hours
- Parallel: true (can work alongside task 004)

## Definition of Done
- [ ] Validation library implemented with all checks
- [ ] Error messages provide clear remediation
- [ ] Rollback mechanism tested for partial failures
- [ ] Integration tested with agent commands
- [ ] No agents can launch in invalid workspaces