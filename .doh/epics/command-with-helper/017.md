---
name: Add comprehensive test coverage for all helper functions
number: 017
status: completed
created: 2025-09-04T08:10:02Z
updated: 2025-09-04T08:10:02Z
github: [Will be updated when synced to GitHub]
epic: command-with-helper
depends_on: [003, 007, 009, 010]
parallel: true
conflicts_with: []
file_version: 0.1.0
---

# Task: Add comprehensive test coverage for all helper functions

## Description
Create comprehensive test suites for all helper functions implemented in the command-with-helper epic, including epic, prd, task, and version domain helpers. This ensures reliability, maintainability, and proper error handling for all helper functions.

## Acceptance Criteria
- [ ] Test suite for epic helper functions (`helper_epic_create`, `helper_epic_parse`, etc.)
- [ ] Test suite for PRD helper functions (`helper_prd_new`, `helper_prd_parse`, etc.)  
- [ ] Test suite for task helper functions (`helper_task_decompose`, `helper_task_status`, `helper_task_update`)
- [ ] Test suite for version helper functions (`helper_version_new`, `helper_version_show`, `helper_version_bump`, etc.)
- [ ] Test coverage for helper bootstrap mechanism (`helper.sh` routing)
- [ ] Tests for error handling and edge cases
- [ ] Tests for parameter validation
- [ ] Tests for API integration (frontmatter, numbering, version APIs)
- [ ] All tests passing with >80% coverage
- [ ] Integration with existing DOH test framework

## Technical Details
**IMPORTANT**: Read [docs/writing-good-scripts.md](docs/writing-good-scripts.md) for complete helper patterns and testing approaches.

### Test Organization
- Create test files in `tests/unit/test_helper_*.sh` pattern
- Use existing DOH test framework functions (prefixed with `_tf_`)
- Follow existing test patterns in the codebase
- Test both success and failure scenarios

### Test Categories

#### Epic Helper Tests (`tests/unit/test_helper_epic.sh`)
- `helper_epic_create()` - epic creation, validation, error handling
- `helper_epic_parse()` - PRD parsing, validation, overwrite scenarios
- `helper_epic_list()` - epic listing and filtering
- `helper_epic_show()` - epic display functionality
- `helper_epic_help()` - help output verification

#### PRD Helper Tests (`tests/unit/test_helper_prd.sh`)
- `helper_prd_new()` - PRD creation, template generation, validation
- `helper_prd_parse()` - PRD analysis, content validation, readiness assessment
- `helper_prd_list()` - PRD listing and categorization
- `helper_prd_status()` - status reporting functionality

#### Task Helper Tests (`tests/unit/test_helper_task.sh`) 
- `helper_task_decompose()` - epic analysis, task discovery
- `helper_task_status()` - task status reporting, metadata extraction
- `helper_task_update()` - status updates, timestamp handling, validation
- Task number validation and file discovery

#### Version Helper Tests (`tests/unit/test_helper_version.sh`)
- `helper_version_new()` - version setting, validation, current version updates
- `helper_version_show()` - version display, file analysis, consistency checking
- `helper_version_bump()` - version incrementing (major/minor/patch), validation
- `helper_version_list()` - version file listing and status display
- `helper_version_compare()` - version comparison logic

#### Bootstrap Tests (`tests/unit/test_helper_bootstrap.sh`)
- `helper.sh` argument parsing and routing
- Domain validation and error handling
- Function discovery and execution
- Help system functionality
- Error messages and exit codes

### Test Implementation Guidelines

#### Use DOH Test Framework
```bash
#!/bin/bash
source "$(dirname "${BASH_SOURCE[0]}")/../lib/tf.sh"

_tf_setup() {
    # Setup test environment, mock dependencies
    export TEST_TMPDIR="$(mktemp -d)"
    cd "$TEST_TMPDIR"
    # Initialize minimal DOH structure
}

_tf_teardown() {
    # Clean up test environment
    rm -rf "$TEST_TMPDIR"
}

test_helper_epic_create_success() {
    # Test successful epic creation
    local result
    result="$(./.claude/scripts/doh/helper.sh epic create test-epic "Test description")"
    _tf_assert_success $? "Epic creation should succeed"
    _tf_assert_contains "$result" "Epic created" "Should confirm epic creation"
}

test_helper_epic_create_validation() {
    # Test parameter validation
    local result
    result="$(./.claude/scripts/doh/helper.sh epic create 2>&1)"
    _tf_assert_failure $? "Should fail without epic name"
    _tf_assert_contains "$result" "Error: Epic name required" "Should show validation error"
}
```

#### Mock External Dependencies
- Mock API calls to avoid side effects
- Use temporary directories for file operations
- Mock git operations for testing
- Isolate tests from real DOH project state

#### Test Data and Fixtures
- Create minimal test PRD files for parsing tests
- Use temporary epics for creation tests
- Mock version files for version testing
- Ensure tests don't interfere with real project data

### Coverage Requirements
- Test all public helper functions
- Test error conditions and edge cases
- Test parameter validation for all functions
- Test API integration points
- Test help and usage messages
- Achieve >80% function coverage

### Integration with Test Runner
- Tests should run via `./tests/run.sh`
- Tests should run via `./tests/test_launcher.sh tests/unit/test_helper_*.sh`
- Support for `VERBOSE=true` for debugging
- Clear test output and failure reporting

## Dependencies
- [ ] Task 003: Epic domain helper must be implemented
- [ ] Task 007: PRD domain helper must be implemented  
- [ ] Task 009: Task domain helper must be implemented
- [ ] Task 010: Version domain helper must be implemented

## Effort Estimate
- Size: L
- Hours: 12-16
- Parallel: true (doesn't modify production code during testing)

## Definition of Done
- [ ] All helper test suites created and comprehensive
- [ ] Tests cover both success and error paths for all functions
- [ ] Tests integrated into DOH test runner framework
- [ ] All tests passing consistently
- [ ] Test coverage >80% for helper functions
- [ ] Tests can be run individually and as part of full suite
- [ ] Test documentation and examples provided
- [ ] Code reviewed and approved
