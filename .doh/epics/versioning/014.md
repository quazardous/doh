---
name: Version migration tools
number: 014
status: completed
created: 2025-08-31T21:30:00Z
updated: 2025-09-01T21:58:00Z
github: [Will be updated when synced to GitHub]
epic: versioning
depends_on: [006, 007]
parallel: false
conflicts_with: []
file_version: 0.1.0
---

# Task: Version migration tools

## Description
Create migration tools to help existing DOH projects adopt the versioning system. This includes automated migration scripts, validation tools, and rollback capabilities for safe adoption of version features.

## Acceptance Criteria
- [x] Create migration script for existing projects ✅
- [x] Implement version file generation from git history ✅
- [x] Add frontmatter to existing markdown files ✅
- [x] Create rollback mechanism ✅
- [x] Validate migration results ✅
- [x] Generate migration reports ✅
- [x] Support incremental migrations ✅

## Technical Details
### Migration Components
1. **Project Analysis**
   - Scan existing project structure
   - Detect current versioning approach
   - Identify files needing updates
   - Estimate migration complexity
   - Generate pre-migration report

2. **Version Initialization**
   - Create VERSION file with appropriate version
   - Generate initial version milestone files
   - Set up .doh/versions/ directory
   - Initialize version registry

3. **File Updates**
   - Add file_version to markdown frontmatter
   - Insert version headers in scripts
   - Update command templates
   - Preserve existing content

4. **Git Integration**
   - Analyze git tags for version history
   - Generate version files from releases
   - Map commits to versions
   - Create version timeline

### Migration Workflow
```bash
/doh:version-migrate [options]
  --analyze      # Analyze without changes
  --dry-run      # Show what would change
  --from-git     # Import from git history
  --interactive  # Step-by-step migration
  --rollback     # Undo migration
```

### Safety Features
1. **Backup Creation**
   - Automatic backup before migration
   - Timestamped backup directories
   - Selective restoration options

2. **Validation**
   - Pre-migration checks
   - Post-migration validation
   - Integrity verification
   - Compatibility testing

3. **Rollback Support**
   - Complete rollback capability
   - Partial rollback options
   - State restoration
   - Clean-up utilities

### Migration Scenarios
1. **New DOH Projects**
   - Simple initialization
   - Default version setup
   - Template generation

2. **Existing DOH Projects**
   - Preserve existing structure
   - Update files incrementally
   - Maintain compatibility

3. **Legacy Projects**
   - Convert from other systems
   - Map version conventions
   - Handle special cases

## Dependencies
- [ ] Version bump workflow (Task 006)
- [ ] Version milestones (Task 007)
- [ ] File manipulation utilities

## Effort Estimate
- Size: L
- Hours: 12-14
- Parallel: false

## Definition of Done
- [x] Migration script fully functional ✅
- [x] All safety features implemented ✅
- [x] Rollback mechanism tested ✅
- [x] Documentation for migration process ✅
- [x] Support for all project types ✅
- [x] Validation and reporting complete ✅
- [x] Error handling comprehensive ✅
- [x] Performance optimized for large projects ✅

## Implementation Summary

**COMPLETED**: Full version migration system successfully implemented (2025-09-01)

### Key Achievements
- ✅ **Complete `/doh:version-migrate` command**: Full-featured migration script with all options
- ✅ **Git history import**: Automatic version timeline generation from git tags
- ✅ **Safety features**: Backup creation, rollback mechanism, validation
- ✅ **Interactive mode**: Step-by-step guided migration process
- ✅ **Integration**: Works with existing migration scripts in `./migration/`
- ✅ **Deduplication**: Integrated number conflict resolution
- ✅ **Comprehensive reporting**: Pre/post migration analysis and reports

### Files Created
- `.claude/scripts/doh/version-migrate.sh` - Main migration script
- `.claude/commands/doh/version-migrate.md` - Command documentation
- Integration with `./migration/` scripts for number deduplication

### Command Usage
```bash
# Full migration workflow
/doh:version-migrate --analyze              # Pre-migration analysis
/doh:version-migrate --dry-run --from-git   # Preview with git import
/doh:version-migrate --interactive          # Guided migration
/doh:version-migrate --deduplicate          # Include number cleanup
/doh:version-migrate --rollback             # Undo migration
```

### Integration Success
- **Migration scripts**: Properly integrated with existing `./migration/` tools
- **Path corrections**: Fixed library paths in all migration scripts
- **Test updates**: Migration integration tests working correctly
- **Version system**: Seamless integration with DOH versioning system