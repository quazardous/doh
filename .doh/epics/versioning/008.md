---
name: Version dependencies in task graph
number: 008
status: closed
created: 2025-08-31T16:20:00Z
updated: 2025-09-01T22:15:00Z
github: [Will be updated when synced to GitHub]
epic: versioning
depends_on: []
parallel: true
conflicts_with: []
file_version: 0.1.0
---

# Task: Version dependencies in task graph

## ✅ COMPLETED - AI + Graph Cache Hybrid Approach

**Implementation Strategy:** Hybrid AI-driven approach with automatic graph cache population for script integration.

## Description
Extend the task graph system to include version dependencies as first-class relationships. This allows tracking which tasks are required for specific versions, enabling better visualization and automated version milestone validation.

## ✅ Implementation Completed (2025-09-01)

**DELIVERED:**
1. **Extended Graph Cache Structure** - Added `versions` section to graph_cache.json schema
2. **Version Relationship Functions** - Complete API in `graph-cache.sh`:
   - `update_version_cache()` - Store version-task relationships
   - `get_version_cache()` - Retrieve version data
   - `get_version_blocking_tasks()` - Find tasks blocking versions
   - `get_task_versions()` - Find versions affected by task
   - `sync_version_cache()` - Auto-sync from version files

3. **AI Command Integration** - Enhanced version management commands:
   - `/doh:version-status` - Auto-populates cache during execution
   - `/doh:version-validate` - Updates cache with parsed relationships
   - `/doh:version-graph` - Complete dependency visualization
   - `/doh:task-versions` - Task impact analysis

4. **Graph Cache Auto-Population** - AI commands automatically maintain cache for script consumption

**APPROACH BENEFITS:**
- **AI Flexibility** - Handles complex parsing and edge cases intelligently
- **Script Integration** - Cached JSON available for bash/synchronization scripts
- **Live Data** - Cache automatically updated during version operations
- **Performance** - Fast queries via cached relationships

## Acceptance Criteria
- [ ] Extend graph_cache structure to include version relationships
- [ ] Add version nodes to the dependency graph
- [ ] Implement bidirectional version-task mappings
- [ ] Create visualization for version dependency trees
- [ ] Update graph queries to support version filtering
- [ ] Integrate with milestone validation system
- [ ] Support version prerequisite chains

## Technical Details

### Enhanced Graph Structure

Current graph_cache in registers.json:
```json
{
  "graph_cache": {
    "005": {
      "parent": "003",
      "epic": "versioning"
    }
  }
}
```

Enhanced structure with version dependencies:
```json
{
  "graph_cache": {
    "005": {
      "parent": "003",
      "epic": "versioning",
      "target_version": "1.0.0",
      "blocks_versions": ["1.0.0", "1.1.0"]
    },
    "versions": {
      "1.0.0": {
        "required_tasks": ["005", "006", "007"],
        "required_epics": ["versioning"],
        "blocks": ["1.1.0", "2.0.0"]
      },
      "1.1.0": {
        "required_tasks": ["008", "009"],
        "depends_on_versions": ["1.0.0"]
      }
    }
  }
}
```

### Graph Operations

1. **Add Version Dependencies**:
```bash
add_version_dependency() {
    local task="$1"
    local version="$2"
    local relationship="$3"  # requires|blocks|optional
    
    # Update graph_cache with version relationship
    # Validate no circular dependencies
}
```

2. **Query Version Dependencies**:
```bash
get_version_blockers() {
    local version="$1"
    # Return all tasks blocking this version
}

get_version_prerequisites() {
    local version="$1"
    # Return all versions that must be released first
}

get_task_versions() {
    local task="$1"
    # Return all versions this task affects
}
```

3. **Version Graph Traversal**:
```bash
traverse_version_graph() {
    local start_version="$1"
    local direction="$2"  # upstream|downstream
    
    # Traverse version dependency chain
    # Return ordered list of versions
}
```

### Graph Visualization

1. **Version Dependency Tree**:
```
Version Graph:

v2.0.0 (future)
  ├── requires: v1.1.0
  └── blocked by: [010, 011, 012]

v1.1.0 (planned)
  ├── requires: v1.0.0
  ├── blocked by: [008, 009]
  └── optional: [013]

v1.0.0 (in-progress)
  ├── blocked by: [005 ✓, 006 ⧗, 007 ⧗]
  └── progress: 33%

v0.1.0 (released) ✓
```

2. **Task Impact View**:
```
Task 005: Frontmatter Integration
  └── Blocks versions:
      ├── v1.0.0 (required)
      ├── v1.1.0 (inherited)
      └── v2.0.0 (inherited)
```

### Integration Points

1. **Task Creation**:
   - Automatically link to target_version from epic
   - Inherit version dependencies from parent tasks
   - Validate version consistency

2. **Task Completion**:
   - Update version progress metrics
   - Check if version milestones achieved
   - Trigger version bump proposals

3. **Version Planning**:
   - Validate version feasibility
   - Identify critical path to version
   - Estimate version completion date

### Graph Cache Library Updates

Update `.claude/scripts/doh/lib/graph-cache.sh`:

```bash
# Version-specific functions
add_task_to_version() {
    local task="$1"
    local version="$2"
    local requirement_type="$3"
    # Add task as requirement for version
}

remove_task_from_version() {
    local task="$1"
    local version="$2"
    # Remove task from version requirements
}

get_version_completion_status() {
    local version="$1"
    # Calculate percentage of completed requirements
}

validate_version_dependencies() {
    local version="$1"
    # Check for circular dependencies
    # Validate prerequisite versions
}
```

### Query Commands

1. **Version Status with Dependencies**:
```bash
/doh:version-graph 1.0.0

Dependencies for v1.0.0:
  Required Tasks: 3 total, 1 complete
    ✓ 005 - Frontmatter integration
    ⧗ 006 - Version bump workflow
    ⧗ 007 - Version milestones
  
  Blocks Versions:
    → v1.1.0 (cannot release until 1.0.0)
    → v2.0.0 (cannot release until 1.0.0)
```

2. **Task Version Impact**:
```bash
/doh:task-versions 005

Task 005 Version Impact:
  Direct: v1.0.0
  Cascading: v1.1.0, v2.0.0
  Critical for: 3 version releases
```

## Dependencies
- [ ] Graph cache system understanding
- [ ] Registry structure knowledge
- [ ] Version milestone system (Task 007)

## Effort Estimate
- Size: M
- Hours: 6-8
- Parallel: true (can work alongside other version tasks)

## Definition of Done
- [ ] Graph structure extended with version nodes
- [ ] Version dependency functions implemented
- [ ] Graph traversal supports versions
- [ ] Visualization commands working
- [ ] Integration with task workflow
- [ ] Circular dependency detection
- [ ] Documentation updated
- [ ] Unit tests for graph operations
- [ ] Integration tests for version flows