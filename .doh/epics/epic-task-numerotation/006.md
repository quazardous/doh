---
name: Integration with existing DOH commands
status: completed
created: 2025-08-31T16:07:07Z
updated: 2025-08-31T20:42:00Z
github: [Will be updated when synced to GitHub]
depends_on: [001, 002]
parallel: false
conflicts_with: []
---

## Task

Integrate the new numbering library with existing DOH commands, ensuring all task and epic creation operations use the centralized numbering system and respect the new numbering rules.

## Description

**UPDATED SCOPE**: Update existing DOH commands that create tasks (`/doh:prd-parse`, `/doh:epic-decompose`) to use the new numbering library instead of their current ad-hoc numbering approaches. This integration enforces the absolute obligation to use the centralized numbering system and ensures consistency across all DOH operations.

**Course Correction**: The task has been refocused on the actual task-creating commands that exist in the system rather than non-existent `/doh:task-new` and `/doh:epic-new` commands.

## Acceptance Criteria

- [ ] `/doh:prd-parse` command uses the numbering library for task creation during PRD decomposition
- [ ] `/doh:epic-decompose` command uses the numbering library for task number assignment
- [ ] All task creation commands (`prd-parse`, `epic-decompose`) use centralized numbering
- [ ] Commands handle numbering conflicts gracefully
- [ ] Queue integration works seamlessly with command execution
- [ ] Backward compatibility maintained for existing projects
- [ ] Error messages are clear and actionable
- [ ] No command can create tasks without using the numbering library

## Technical Details

### Command Integration Points

#### `/doh:prd-parse` Integration
- Replace current task numbering with calls to `numbering.sh` library functions
- Handle conflicts by queuing renumbering operations when PRD generates multiple tasks
- Update task creation workflow during PRD decomposition to respect numbering constraints
- Maintain existing command parameters and PRD parsing behavior

#### `/doh:epic-decompose` Integration
- Replace current task numbering with calls to `numbering.sh` library functions
- Handle task sequence numbering when decomposing epics into tasks
- Ensure task numbering is consistent within epic boundaries
- Update epic decomposition workflow to use centralized numbering

### Integration Requirements
- **Absolute Obligation**: No alternative numbering paths allowed
- **Conflict Resolution**: Use queue system for deferred operations
- **Error Handling**: Clear feedback when numbering fails
- **Transaction Safety**: Rollback on numbering failures
- **Audit Trail**: Log all numbering decisions and conflicts

### Backward Compatibility
- Existing projects continue to work without migration
- New numbering only applies to new tasks/epics
- Migration path available for projects that opt-in
- Clear documentation on behavioral changes

### Code Changes
```typescript
// Before
const nextNumber = findMaxNumber() + 1;

// After
const nextNumber = await NumberingLibrary.getNextTaskNumber(projectId, options);
```

## Dependencies

- **Task 001**: Core numbering library implementation
- **Task 002**: Numbering rules and conflict resolution
- Existing command infrastructure
- Project context management
- Error handling frameworks

## Effort Estimate

**Large** - 4-5 days
- Code analysis and refactoring: 8 hours
- `/doh:task-new` integration: 8 hours
- `/doh:epic-new` integration: 6 hours
- Error handling and user feedback: 6 hours
- Backward compatibility testing: 8 hours
- Integration testing: 8 hours
- Documentation updates: 4 hours

## Definition of Done

- [ ] All task creation goes through numbering library
- [ ] All epic creation goes through numbering library
- [ ] No direct number assignment outside the library
- [ ] Conflict resolution integrates with queue system
- [ ] Error handling provides clear user guidance
- [ ] Existing projects continue to function
- [ ] New projects use new numbering system
- [ ] Integration tests pass for all scenarios
- [ ] Performance impact is minimal
- [ ] Documentation reflects new behavior
- [ ] Code review confirms no numbering bypass paths
- [ ] User acceptance testing validates workflow changes