---
name: Migration tools for deduplication and conflict resolution
status: completed
created: 2025-08-31T16:07:07Z
updated: 2025-08-31T19:35:00Z
github: [Will be updated when synced to GitHub]
depends_on: [001]
parallel: true
conflicts_with: []
---

# Task: Migration tools for deduplication and conflict resolution

## Description

Develop comprehensive migration tools to handle existing DOH projects that may have duplicate numbers, inconsistent numbering schemes, or conflicting task/epic assignments. These tools will provide automated deduplication, dependency tracking during renumbering operations, and conflict resolution mechanisms.

The migration system will include a message queue for recording and resolving conflicts, ensuring that all existing project data can be safely migrated to the new numbering system without data loss or broken relationships.

## Acceptance Criteria

- [ ] Duplicate number detection across entire project structure
- [ ] Deduplication algorithm based on creation date priority
- [ ] Dependency tracking during renumbering operations
- [ ] Message queue implementation for conflict records
- [ ] Backup and rollback mechanisms for failed migrations
- [ ] Migration validation and verification tools
- [ ] Batch processing for large projects with progress reporting
- [ ] Conflict resolution interactive mode for manual decisions
- [ ] Migration report generation with detailed logs

## Technical Details

### Migration Tools Structure:
```bash
.claude/scripts/doh/migration/
├── migrate.sh              # Main migration orchestrator
├── detect_duplicates.sh    # Duplicate detection utility
├── deduplicate.sh         # Automated deduplication
├── resolve_conflicts.sh   # Interactive conflict resolution
├── validate_migration.sh  # Post-migration validation
└── rollback.sh           # Migration rollback utility
```

### Deduplication Strategy:
1. **Detection Phase**:
   - Scan all epic and task files for number collisions
   - Build conflict map with file paths and creation dates
   - Identify dependency chains that would be affected

2. **Resolution Phase**:
   - Priority: earlier creation date keeps original number
   - Later files get next available number in sequence
   - Update all cross-references automatically
   - Preserve git history with proper commit messages

### Message Queue Schema:
```json
{
  "conflicts": [
    {
      "id": "conflict-001",
      "type": "duplicate_number",
      "number": "001",
      "files": [
        {
          "path": ".doh/epics/epic-a/001.md",
          "created": "2025-08-30T10:00:00Z"
        },
        {
          "path": ".doh/epics/epic-b/001.md", 
          "created": "2025-08-31T10:00:00Z"
        }
      ],
      "resolution": "automatic",
      "new_assignments": {
        ".doh/epics/epic-b/001.md": "002"
      },
      "status": "resolved",
      "resolved_at": "2025-08-31T16:07:07Z"
    }
  ]
}
```

### Dependency Tracking:
- Map all depends_on references before renumbering
- Update references atomically after number changes
- Validate dependency graph integrity post-migration
- Handle circular dependencies with warnings

## Dependencies

- **Task 001**: Core numbering library with registry management
  - Requires registry functions for new number assignment
  - Uses validation functions for consistency checks

## Effort Estimate

**Size**: M (Medium)  
**Hours**: 10-14 hours

### Breakdown:
- Duplicate detection logic: 3 hours
- Deduplication algorithm implementation: 3 hours
- Conflict resolution interface: 2 hours
- Message queue and logging: 2 hours
- Validation and rollback mechanisms: 2 hours
- Testing with sample conflicts: 2 hours

## Definition of Done

- [ ] All acceptance criteria are met
- [ ] Migration handles projects with 100+ duplicate numbers
- [ ] Dependency references are correctly updated after renumbering
- [ ] Interactive conflict resolution provides clear options
- [ ] Rollback mechanism restores original state completely
- [ ] Migration reports are comprehensive and actionable
- [ ] Performance is acceptable for large projects (1000+ files)
- [ ] Integration tests cover common conflict scenarios
- [ ] Code review completed and approved
- [ ] User documentation includes migration best practices