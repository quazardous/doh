---
name: File discovery and graph cache implementation
status: completed
created: 2025-08-31T16:07:07Z
updated: 2025-08-31T19:35:00Z
github: [Will be updated when synced to GitHub]
depends_on: [001]
parallel: false
conflicts_with: []
---

# Task: File discovery and graph cache implementation

## Description

Implement a high-performance caching system for fast lookups of numbered files and their relationships within the DOH project management system. This system will provide two types of caches: a file cache for mapping numbers to file paths, and a graph cache for tracking parent/epic relationships and dependencies.

The cache implementation will include self-healing capabilities to automatically detect and resolve inconsistencies between cached data and the actual markdown files on disk.

## Acceptance Criteria

- [ ] File cache implementation that maps numbers to file paths
- [ ] Graph cache implementation for tracking parent/epic relationships
- [ ] Cache invalidation mechanisms for file system changes
- [ ] Self-healing functionality when cache is inconsistent with .md files
- [ ] Cache persistence across system restarts
- [ ] Performance benchmarks showing significant lookup speed improvements
- [ ] Cache corruption detection and automatic rebuilding
- [ ] Integration with the core numbering library (Task 001)
- [ ] Comprehensive test coverage for all cache operations

## Technical Details

### File Cache Structure:
```json
{
  "numbers_to_paths": {
    "epic-001": ".doh/epics/epic-name/epic.md",
    "task-001-001": ".doh/epics/epic-name/001.md"
  },
  "paths_to_numbers": {
    ".doh/epics/epic-name/epic.md": "epic-001",
    ".doh/epics/epic-name/001.md": "task-001-001"
  },
  "last_updated": "2025-08-31T16:07:07Z",
  "version": "1.0"
}
```

### Graph Cache Structure:
```json
{
  "relationships": {
    "epic-001": {
      "type": "epic",
      "children": ["task-001-001", "task-001-002"],
      "dependencies": [],
      "conflicts": []
    },
    "task-001-001": {
      "type": "task",
      "parent": "epic-001",
      "dependencies": [],
      "conflicts": ["task-002-001"]
    }
  },
  "dependency_graph": {
    "nodes": ["epic-001", "task-001-001"],
    "edges": [["epic-001", "task-001-001"]]
  }
}
```

### Cache Location:
- File cache: `~/.doh/projects/{project-id}/file_cache.json`
- Graph cache: `~/.doh/projects/{project-id}/graph_cache.json`

### Self-Healing Features:
- Detect missing files referenced in cache
- Identify new files not in cache
- Validate frontmatter consistency
- Automatic cache rebuilding on corruption
- Incremental updates for performance

## Dependencies

- **Task 001**: Core numbering library with registry management
  - Requires registry functions for cache validation
  - Uses numbering library for consistent number handling

## Effort Estimate

**Size**: L (Large)  
**Hours**: 14-18 hours

### Breakdown:
- Cache architecture design: 3 hours
- File cache implementation: 4 hours
- Graph cache implementation: 4 hours
- Self-healing mechanisms: 4 hours
- Performance optimization: 2 hours
- Testing and validation: 3 hours

## Definition of Done

- [ ] All acceptance criteria are met
- [ ] Cache provides 10x+ performance improvement over file system scans
- [ ] Self-healing works correctly for all inconsistency scenarios
- [ ] Cache operations are thread-safe and atomic
- [ ] Memory usage is optimized for large projects (1000+ files)
- [ ] Integration tests pass with core numbering library
- [ ] Performance benchmarks meet requirements
- [ ] Code review completed and approved
- [ ] Documentation includes cache maintenance procedures