---
name: implement-dryrun-api-support
number: 050
epic: data-api-sanity
status: pending
created: 2025-09-03T09:30:00Z
parallel: false
file_version: 0.1.0
---

# Task: implement-dryrun-api-support

## Overview

Implement DRYRUN support across DOH API functions and helper scripts to enable safe testing of git operations and other potentially destructive commands. This addresses the need for comprehensive testing without risk of corrupting the repository state.

## Acceptance Criteria

### Core DRYRUN Infrastructure
- [ ] Add `DOH_DRYRUN` environment variable support to core DOH libraries
- [ ] Implement DRYRUN mode in `doh.sh` core library with logging functions
- [ ] Create `dryrun_log()` and `dryrun_execute()` helper functions
- [ ] Add DRYRUN detection and warning messages

### Git Operation Safety
- [ ] Implement DRYRUN support in epic helper functions:
  - `helper_epic_validate_prerequisites()`
  - `helper_epic_create_or_enter_branch()`
  - `helper_epic_identify_ready_tasks()`
- [ ] Add DRYRUN support to version operations that modify files
- [ ] Ensure all git commands can be safely simulated

### Test Framework Integration
- [ ] Enable DRYRUN mode in test framework for dangerous operations
- [ ] Update `test_epic_helper_functions.sh` to uncomment dangerous tests
- [ ] Add DRYRUN test execution mode to test runner
- [ ] Create validation tests for DRYRUN functionality

### API Consistency
- [ ] Ensure all DOH API functions respect `DOH_DRYRUN` environment variable
- [ ] Add DRYRUN parameter support to helper.sh commands
- [ ] Document DRYRUN usage patterns in API documentation

## Technical Implementation

### Environment Variable Convention
```bash
# Enable DRYRUN mode
export DOH_DRYRUN=1

# Run commands safely
./.claude/scripts/doh/helper.sh epic create-branch "feature-branch"  # Will log but not execute
```

### Core Functions to Implement
```bash
# In doh.sh
doh_is_dryrun()        # Check if DRYRUN mode is enabled
doh_dryrun_log()       # Log what would be executed
doh_dryrun_execute()   # Execute command only if not in DRYRUN mode
```

### Integration Points
- Epic helper functions in `.claude/scripts/doh/helper/epic.sh`
- Version operations in `.claude/scripts/doh/lib/version.sh`
- Test framework in `tests/helpers/test_framework.sh`
- Command templates and documentation

## Dependencies

### Internal Dependencies
- Task 025: Core doh.sh library implementation (completed)
- Task 026: Command API compliance (in progress)
- Test framework implementation from test-driven-dev epic

### External Dependencies
- Bash 4.0+ for environment variable handling
- Git operations that need safe simulation

## Definition of Done

- [ ] `DOH_DRYRUN=1` prevents all destructive operations
- [ ] All dangerous tests in `test_epic_helper_functions.sh` uncommented and passing
- [ ] DRYRUN mode documented in DEVELOPMENT.md
- [ ] Integration tests verify DRYRUN functionality across all affected libraries
- [ ] No regression in existing functionality when DRYRUN disabled

## Risk Mitigation

- Start with epic helpers as they have the most dangerous git operations
- Test DRYRUN implementation thoroughly before enabling in production code
- Maintain backward compatibility - DRYRUN defaults to disabled
- Document DRYRUN behavior clearly to prevent misuse

## Estimated Effort: 4-6 hours

Critical for enabling comprehensive testing of git operations without repository corruption risk.