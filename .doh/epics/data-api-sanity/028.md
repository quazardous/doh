---
number: 028
epic: 024
title: Update documentation and create command development templates
status: pending
created: 2025-09-02T07:57:13Z
target_version: 0.7.0
file_version: 0.1.0
---

# Task 028: Update documentation and create command development templates

## Overview
Update all DOH documentation to reflect the new library architecture, API-first approach, and no-op sourcing patterns. Create comprehensive templates and guides to ensure future development follows the established patterns.

## Requirements

### 1. CLAUDE.md Documentation Update
Update `.claude/CLAUDE.md` with new library usage patterns:

**New Library Loading Section:**
```markdown
## DOH Library Usage for AI Agents

### Core Architecture
- **doh.sh**: Core foundational library (zero dependencies)
- **dohenv.sh**: Environment library (sources doh.sh)
- **Specialized libraries**: Source doh.sh + dohenv.sh + dependencies

### No-Op Sourcing Pattern
All libraries are no-op when sourced:
```bash
# Safe sourcing - no automatic execution
source .claude/scripts/doh/lib/doh.sh
source .claude/scripts/doh/lib/dohenv.sh
source .claude/scripts/doh/lib/version.sh

# Explicit initialization when needed
load_doh_env  # Only when environment loading required
```

### Dependency Loading Examples
- Minimal: `source .claude/scripts/doh/lib/doh.sh`
- Environment: `source .claude/scripts/doh/lib/doh.sh && source .claude/scripts/doh/lib/dohenv.sh`
- Version ops: `source .claude/scripts/doh/lib/doh.sh && source .claude/scripts/doh/lib/dohenv.sh && source .claude/scripts/doh/lib/version.sh`

### API Function Usage
- Use public API functions (no `_` prefix)
- Replace direct file access with API calls
- Always use `get_current_version` instead of `cat VERSION`
```

### 2. DOH Data API Documentation Update
Update `docs/doh-data-api.md` with refactored architecture:

**Updated Sections:**
- Library dependency tree with new `doh.sh` core
- No-op sourcing pattern explanation
- API function reference for each library
- Migration guide from direct access patterns
- Function naming convention documentation
- Error handling patterns
- Integration testing guidance

### 3. Command Development Templates
Create standardized templates for new DOH commands:

**`.claude/templates/doh-command-template.md`:**
```markdown
---
allowed-tools: Bash, Read, Write, LS
---

# Command: [Command Name]

[Command description]

## Implementation Template

```bash
# 1. Library Loading (choose appropriate level)
source .claude/scripts/doh/lib/doh.sh
source .claude/scripts/doh/lib/dohenv.sh
# Add other libraries as needed

# 2. Explicit initialization (only when needed)
# load_doh_env  # Uncomment if environment loading required

# 3. Use API functions exclusively
current_version=$(get_current_version)
status=$(get_frontmatter_field "$file" "status")

# 4. Error handling
if [[ $? -ne 0 ]]; then
    echo "❌ Error: [specific error message]"
    exit 1
fi
```

## Guidelines
- Use API functions, never direct file access
- Follow no-op library sourcing pattern
- Use public API functions (no `_` prefix)
- Implement consistent error handling
```

### 4. Migration Guide Creation
Create comprehensive migration guide:

**`docs/api-migration-guide.md`:**
- Before/after examples for common patterns
- Direct access → API function mapping table
- Library loading pattern changes
- Error handling updates
- Testing strategy for migrated code
- Common pitfalls and solutions

### 5. Troubleshooting Guide Enhancement
Update troubleshooting documentation:

**Enhanced Troubleshooting Sections:**
- No-op sourcing pattern issues
- Library dependency resolution errors
- API function usage errors  
- Function naming convention violations
- Missing initialization patterns
- Performance considerations

## Acceptance Criteria

### Documentation Completeness
- [ ] CLAUDE.md updated with new library patterns
- [ ] doh-data-api.md reflects refactored architecture
- [ ] Migration guide covers all common patterns
- [ ] Troubleshooting guide addresses new architecture
- [ ] All documentation examples use API functions

### Template Quality
- [ ] Command template shows proper library loading
- [ ] Template demonstrates API function usage
- [ ] Template includes error handling patterns
- [ ] Template follows naming conventions
- [ ] Template is ready for immediate use

### Documentation Accuracy
- [ ] All examples tested and working
- [ ] Library dependency information accurate
- [ ] API function documentation complete
- [ ] Migration examples validated
- [ ] No references to deprecated patterns

### User Experience
- [ ] Clear guidance for AI agents
- [ ] Easy-to-follow patterns for developers
- [ ] Comprehensive troubleshooting coverage
- [ ] Reduced learning curve for new architecture
- [ ] Self-service documentation quality

## Implementation Strategy

### Phase 1: Core Documentation Updates
1. Update CLAUDE.md with new library patterns
2. Revise doh-data-api.md architecture sections
3. Validate all examples work with new libraries
4. Remove deprecated pattern references

### Phase 2: Template Creation
1. Create command development template
2. Include comprehensive usage examples
3. Add error handling patterns
4. Test template with sample commands

### Phase 3: Migration Guide Development
1. Document common migration patterns
2. Create before/after code examples
3. Add troubleshooting for migration issues
4. Include validation strategies

### Phase 4: Validation and Refinement
1. Test all documentation examples
2. Validate templates with real implementations
3. Gather feedback on clarity and completeness
4. Refine based on actual usage patterns

## Documentation Sections to Update

### CLAUDE.md
- [ ] DOH Library Loading Guide
- [ ] API Usage Examples
- [ ] Troubleshooting Section
- [ ] Error Pattern Recognition

### docs/doh-data-api.md
- [ ] Architecture Overview
- [ ] Library Dependency Tree
- [ ] API Function Reference
- [ ] Integration Patterns

### New Documents
- [ ] Command Development Template
- [ ] API Migration Guide
- [ ] Advanced Troubleshooting Guide
- [ ] API Function Quick Reference

## Dependencies
- Completed library refactoring (Task 025)
- API function implementation (Task 027)
- Understanding of new architecture patterns
- Access to documentation system
- Testing framework for example validation

## Estimated Effort
2-3 days (comprehensive documentation overhaul)

## Success Metrics
- Zero questions about new library loading patterns
- AI agents successfully use libraries on first attempt
- New commands follow established patterns consistently
- Migration from old patterns is straightforward
- Documentation serves as complete self-service resource