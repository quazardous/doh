---
number: 027
epic: 024
title: Create missing API functions and validate library coverage
status: pending
created: 2025-09-02T07:57:13Z
target_version: 0.7.0
file_version: 0.1.0
---

# Task 027: Create missing API functions and validate library coverage

## Overview
Identify and implement missing API functions discovered during command audit, ensure complete API coverage for all DOH operations, and validate that the library ecosystem provides all necessary functionality for command operations.

## Requirements

### 1. API Gap Analysis
Based on command audit findings, identify missing API functions:

**Likely Missing Functions:**
- `version_set_current` in `version.sh`
- `cache_list_epics` in `file-cache.sh`
- `cache_list_tasks` in `file-cache.sh`
- `cache_find_file_by_number` in `file-cache.sh`
- `version_create_file` in `version.sh`
- `version_validate_format` in `version.sh`
- Registry manipulation functions in `registers.sh`
- Frontmatter update functions in `frontmatter.sh`

### 2. API Function Implementation
For each missing function, implement with:
- **Proper Library Placement**: Place function in most appropriate library
- **Naming Convention**: Follow `_{lib_name}_` prefix for private, `{lib_name}_` prefix for public API
- **Error Handling**: Consistent error handling patterns
- **Documentation**: Clear function documentation and usage examples
- **Testing**: Unit tests for each new function

### 3. Library API Completeness Validation
Ensure each library provides comprehensive API coverage:

**doh.sh (Core Library):**
- `doh_project_dir` - Find project root directory
- Core utility functions needed by all other libraries

**dohenv.sh (Environment Library):**
- `dohenv_load` - Explicit environment loading
- Environment validation and setup functions

**version.sh (Version Management):**
- `version_get_current` - Read VERSION file
- `version_set_current` - Write VERSION file
- `version_validate_format` - Validate semantic version format
- `version_create_file` - Create new version files
- `version_list` - List available versions

**frontmatter.sh (Frontmatter Operations):**
- `frontmatter_get_field` - Read frontmatter field
- `frontmatter_set_field` - Update frontmatter field
- `frontmatter_validate` - Validate frontmatter format
- `frontmatter_extract` - Extract entire frontmatter block

**file-cache.sh (File Discovery):**
- `cache_list_epics` - List all epic directories
- `cache_list_tasks` - List tasks for epic
- `cache_find_file_by_number` - Find file by number/ID
- `cache_get_file_status` - Get status from file frontmatter
- Cache invalidation and management functions

**registers.sh (Registry Operations):**
- Registry read/write functions
- Entity registration functions
- Registry validation and maintenance

### 4. API Function Testing Framework
Create comprehensive testing for all API functions:
- Unit tests for each function
- Integration tests for function combinations
- Error handling validation
- Performance testing for file operations
- Edge case testing

### 5. API Documentation Update
Create comprehensive API documentation:
- Function signatures and parameters
- Usage examples for each function
- Error handling documentation
- Library dependency information
- Migration guide from direct access patterns

## Acceptance Criteria

### Complete API Coverage
- [ ] All command requirements covered by API functions
- [ ] No gaps in functionality between direct access and API functions
- [ ] All common DOH operations have API function equivalents
- [ ] API functions provide better error handling than direct access

### Function Quality Standards
- [ ] All functions follow naming convention (`_{lib_name}_` for private, `{lib_name}_` for public)
- [ ] Consistent error handling across all functions
- [ ] Comprehensive input validation
- [ ] Clear and consistent function signatures
- [ ] Proper documentation for each function

### Testing Coverage
- [ ] Unit tests for all new API functions
- [ ] Integration tests for function combinations
- [ ] Error handling tests for edge cases
- [ ] Performance tests for file operations
- [ ] All tests pass consistently

### Documentation Completeness
- [ ] API reference documentation complete
- [ ] Usage examples for each function
- [ ] Migration guide from direct access patterns
- [ ] Library dependency documentation
- [ ] Error handling guide

## Implementation Strategy

### Phase 1: Gap Identification
1. Analyze command audit results to identify missing functions
2. Categorize by library and functionality type
3. Prioritize based on command usage frequency
4. Define function specifications and signatures

### Phase 2: Function Implementation
1. Implement high-priority functions first
2. Follow naming convention and error handling patterns
3. Add comprehensive input validation
4. Include inline documentation

### Phase 3: Testing Implementation
1. Create unit tests for each function
2. Add integration tests for function combinations
3. Test error handling and edge cases
4. Validate performance characteristics

### Phase 4: Documentation and Validation
1. Create comprehensive API documentation
2. Write usage examples and migration guides
3. Validate complete API coverage
4. Test with actual command migrations

## Function Implementation Checklist

For each API function:
- [ ] Proper library placement determined
- [ ] Function signature defined
- [ ] Naming convention followed
- [ ] Input validation implemented
- [ ] Error handling implemented
- [ ] Inline documentation added
- [ ] Unit tests created
- [ ] Integration tests added
- [ ] Performance validated
- [ ] Documentation updated

## Dependencies
- Command audit results (Task 026)
- Core library architecture (Task 025)
- Understanding of DOH data structures
- Testing framework access
- Documentation system access

## Estimated Effort
3-4 days (comprehensive API function development and testing)

## Success Metrics
- Zero gaps between command needs and API availability
- All commands can migrate to API functions without functionality loss
- API functions provide better error handling than direct access
- Complete test coverage for all new functions
- Comprehensive documentation for API usage