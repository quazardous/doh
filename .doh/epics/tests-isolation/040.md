---
name: Implement test framework isolation setup
description: Add automatic DOH_GLOBAL_DIR override using mktemp -d in test framework
status: pending
created: 2025-09-02T15:53:24Z
target_version: 0.6.0
file_version: 0.1.0
epic: tests-isolation
---

# Task 040: Implement test framework isolation setup

## Objective
Modify the test framework to automatically set up test isolation using secure temporary directories.

## Implementation
1. **Add isolation functions** to `tests/helpers/test_framework.sh`:
   ```bash
   _tf_setup_test_isolation() {
       export DOH_GLOBAL_DIR="$(mktemp -d)"
       export DOH_TEST_CLEANUP_DIR="$DOH_GLOBAL_DIR"
   }
   
   _tf_teardown_test_isolation() {
       [[ -n "$DOH_TEST_CLEANUP_DIR" ]] && rm -rf "$DOH_TEST_CLEANUP_DIR"
       unset DOH_GLOBAL_DIR DOH_TEST_CLEANUP_DIR
   }
   ```

2. **Integrate with test runner**: Automatically call setup/teardown in `_tf_run_test_file()`

3. **Error handling**: Ensure cleanup occurs even on test failures

## Success Criteria
- [ ] All tests run with isolated DOH_GLOBAL_DIR
- [ ] Temporary directories are cleaned up after tests
- [ ] No test artifacts remain in ~/.doh/
- [ ] Test isolation is transparent to test authors

## Dependencies
- Task 038: Research findings
- Task 039: Function naming fixes