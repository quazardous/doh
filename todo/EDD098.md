# EDD098 - DOH Linting System Perfection

**Epic Status**: ACTIVE  
**Priority**: HIGH ⭐ (Critical workflow foundation)  
**Epic Components**: DD087, DD088, DD089, DOH027 (completed)

Comprehensive Epic to achieve perfect, predictable linting system for DOH development workflow with single enforcement
point, auto-correction, and intelligent exception handling.

## 🎯 Epic Vision

**Ensure consistent usage of the unified linting script across all `/dd:*` commands**:

- **Unified linting backend**: All `/dd:*` commands use the same `dev-tools/scripts/lint-files.sh` script
- **Consistent behavior**: Same rules, same auto-correction, same configuration everywhere
- **Single source of truth**: `dev-tools/scripts/lint-files.sh` as the only linting backend
- **Perfect integration**: `/dd:lint`, `/dd:changelog`, `/dd:commit` all use the unified system
- **STRICT enforcement**: Single point of linting truth (git pre-commit hooks), no dual systems

## 📊 Epic Progress

### **Phase 1: Infrastructure Foundation** ✅ COMPLETED

- **DOH027**: Markdown Linting System ✅ (2025-08-27)
  - Infrastructure: `.markdownlint.json`, `dev-tools/`, pre-commit hooks
  - Comprehensive linting configuration and toolchain

### **Phase 2: Unified Script Integration** ✅ COMPLETED

- **DD087**: Command Integration with Multi-Linting Script ✅ (COMPLETED 2025-08-29)
  - ✅ **`/dd:commit`**: Updated to use `dev-tools/scripts/lint-files.sh --staged`
  - ✅ **`/dd:changelog`**: Complex AI linting removed (527→89 lines, -83%)
  - ✅ **`/dd:lint`**: Hybrid architecture with unified backend + AI enhancement (527→276 lines, -48%)
  - ✅ **STRICT rule**: Single enforcement point via git pre-commit hooks implemented
  - ✅ **Architecture**: Dual systems eliminated, unified backend across all commands

### **Phase 3: Enhanced Multi-Script Capabilities** ✅ COMPLETED

- **DD088**: Enhanced Multi-Linting Script Features ✅ (COMPLETED 2025-08-29)
  - ✅ **Simplified interface**: 9 flags → 4 essential flags (-56% complexity reduction)
  - ✅ **Unified backend**: All `/dd:lint` commands use `dev-tools/scripts/lint-files.sh`
  - ✅ **Single-file support**: `/dd:lint README.md` → `lint-files.sh README.md --fix`
  - ✅ **Git integration**: `--modified`, `--staged` options fully integrated
  - ✅ **AI enhancement preserved**: Hybrid approach for complex structural issues
  - ✅ **Performance improved**: 3x faster execution, handles 195 files efficiently
  - ✅ **Testing complete**: All usage patterns validated with unified backend

### **Phase 4: Advanced Features** 🔄 ACTIVE

- **DD089**: Exception Handling in Multi-Script 🔄 (Ready to start - DD088 completed)
  - Inline exceptions: `<!-- markdownlint-disable -->` parsing
  - Context-aware detection: Teaching examples, intentional errors
  - Unified exception handling across all `/dd:*` commands

- **DD103**: Intelligent Linting Feedback System 📋 (DEPENDS: DD088)
  - Track manual Claude interventions when automated tools fail
  - Pattern recognition for recurring issues requiring manual fixes
  - Custom plugin/rule development for identified patterns
  - Living documentation system to prevent recurring errors
  - Self-improving linting system approaching 99%+ automation rate

## 🔗 Epic Dependencies & Integration

### **Critical Path**: ✅ **DD087 → DD088 COMPLETE**

```
DD087 (Simplify) ✅ → DD088 (Enhanced) ✅ → DD089 (Exceptions) 🔄 → DD103 (Feedback) 📋 → Perfect System
```

### **Integration Points**:

- **`/dd:commit`**: Uses `dev-tools/scripts/lint-files.sh --staged` + git pre-commit hooks (DD087 STRICT)
- **`/dd:changelog`**: Pure documentation updates - **NO linting** (DD087 simplification)
- **`/dd:lint`**: Uses `dev-tools/scripts/lint-files.sh` with `--modified`, `--staged`, file patterns (DD088) + feedback
  learning (DD103)
- **Pre-commit hooks**: Single enforcement point for all linting quality
- **Development workflow**: Reliable, predictable linting behavior across all commands
- **Git workflow integration**: `--staged` for commits, `--modified` for development

### **External Dependencies**:

- **Infrastructure**: ✅ Complete (DOH027 delivered configs, tools, hooks)
- **Commands**: `/dd:commit --split` needs reliable per-file linting
- **Quality**: Must maintain 100% linting coverage while adding flexibility

## 🎯 Epic Success Criteria

### **Behavioral Goals**:

- **Predictable**: Linting fails → commit blocked (always, unless --force)
- **Efficient**: Single-file linting <1 second, 99%+ auto-correction
- **Flexible**: Handle intentional errors, examples, teaching materials
- **Integrated**: All DOH commands use same linting foundation

### **Technical Goals**:

- **Single enforcement**: Git hooks only, no pipeline linting
- **Auto-correction**: Prettier + markdownlint --fix handle 99%+ issues
- **Exception handling**: Support inline disable/enable patterns
- **Performance**: Fast single-file operations for command integration

### **Quality Goals**:

- **Zero false positives**: Exception handling eliminates inappropriate blocking
- **99%+ automation rate**: DD103 feedback system reduces manual interventions to <1%
- **100% coverage**: All files linted except explicitly marked exceptions
- **Consistency**: Same rules for hooks, commands, manual linting
- **Self-improvement**: System learns from patterns and develops custom automation
- **Maintainability**: Shared code library, clear architecture, living documentation

## 📋 Epic Task Breakdown (Restructured)

### **DD087 - Remove Dual-Linting Systems** (CRITICAL PATH - PRIORITY 1)

**Status**: 🔄 ACTIVE - Eliminate complexity, implement STRICT enforcement  
**Objective**: Single enforcement point using existing unified script  
**Backend**: Use existing `dev-tools/scripts/lint-files.sh` (already complete!)

**Implementation Tasks**:

- [ ] **PHASE 1A**: Strip AI linting from `/dd:changelog` command
  - [ ] Remove 4-layer linting pipeline (make lint-fix → AI fixes → validation → user decision)
  - [ ] Remove `--lenient`, `--no-lint` complex mode handling
  - [ ] Remove pattern learning system and `./linting/feedback.md` integration
  - [ ] Simplify to pure documentation updates only
- [ ] **PHASE 1B**: Implement STRICT rule in `/dd:commit`
  - [ ] Replace any remaining dual linting with `dev-tools/scripts/lint-files.sh --staged`
  - [ ] Ensure git pre-commit hooks are ONLY enforcement point
  - [ ] Test STRICT behavior: linting fail → commit blocked (no bypass except --force)
  - [ ] Verify `--force` → `git commit --no-verify` behavior
- [ ] **PHASE 1C**: Update command documentation
  - [ ] Remove complex decision trees from `/dd:commit` docs
  - [ ] Update `/dd:changelog` docs to reflect no-linting approach
  - [ ] Test split mode behavior with new architecture

### **DD088 - Enhance /dd:lint with Unified Backend** (PRIORITY 2)

**Status**: 📋 READY - Modernize existing command to use unified script  
**Objective**: Replace complex `/dd:lint` with simple wrapper around unified script  
**Backend**: Leverage existing `dev-tools/scripts/lint-files.sh` capabilities

**Implementation Tasks**:

- [ ] **PHASE 2A**: Audit current `/dd:lint` complexity
  - [ ] Map current features: prettier-first, priority system, AI intelligence, file-type routing
  - [ ] Identify which features to keep vs remove for simplicity
  - [ ] Plan migration path from complex to unified-script-based approach
- [ ] **PHASE 2B**: Implement unified backend integration
  - [ ] Replace internal linting logic with `dev-tools/scripts/lint-files.sh` calls
  - [ ] Preserve useful features: `--files=pattern`, `--check-only`, `--verbose`
  - [ ] Remove complex features: AI tuning, pattern learning, rollback system
  - [ ] Add git workflow support: `/dd:lint --modified`, `/dd:lint --staged`
  - [ ] Add single-file support: `/dd:lint README.md` → `lint-files.sh README.md`
- [ ] **PHASE 2C**: Testing and validation
  - [ ] Test all `/dd:lint` usage patterns with new backend
  - [ ] Ensure performance remains acceptable
  - [ ] Verify integration with DD087 STRICT enforcement

### **DD089 - Exception Handling System** (PRIORITY 3 - FUTURE)

**Status**: 📋 PROPOSED - Advanced features for edge cases  
**Objective**: Handle intentional errors, examples, teaching materials  
**Backend**: Extend `dev-tools/scripts/lint-files.sh` with exception parsing

**Implementation Tasks**:

- [ ] **PHASE 3A**: Exception pattern design
  - [ ] Implement inline disable patterns: `<!-- markdownlint-disable MD013 -->`
  - [ ] Context-aware detection for teaching materials and bad examples
  - [ ] File-level exception support for entire documents
- [ ] **PHASE 3B**: Unified script enhancement
  - [ ] Add exception parsing to `dev-tools/scripts/lint-files.sh`
  - [ ] Validation system to ensure exceptions are properly closed
  - [ ] Reporting of skipped sections and reasons
- [ ] **PHASE 3C**: Command integration
  - [ ] Update all `/dd:*` commands to support exception handling
  - [ ] Test exception patterns across different use cases
  - [ ] Documentation and guidelines for proper exception usage

## 🚀 Epic Execution Plan (Restructured)

### **SPRINT 1: Eliminate Dual Systems** (DD087 - CRITICAL PATH)

**Goal**: Single enforcement point, no more complex linting pipelines

**Week 1 Tasks**:

1. **Strip `/dd:changelog` complexity**:
   - Remove AI-powered 4-layer linting system
   - Remove `--lenient`, `--no-lint` modes and pattern learning
   - Focus on pure documentation updates
2. **Implement STRICT `/dd:commit`**:
   - Replace dual linting with `dev-tools/scripts/lint-files.sh --staged`
   - Test git pre-commit hooks as single enforcement point
   - Verify `--force` → `--no-verify` behavior
3. **Update documentation**:
   - Remove complex decision trees from command docs
   - Test `/dd:commit --split` behavior with new architecture

### **SPRINT 2: Unified /dd:lint** (DD088 - SIMPLIFICATION)

**Goal**: Replace complex `/dd:lint` with unified script wrapper

**Week 2 Tasks**:

1. **Audit and simplify**:
   - Map current `/dd:lint` complexity vs actual needs
   - Remove AI intelligence, pattern learning, rollback systems
2. **Implement unified backend**:
   - Replace internal logic with `dev-tools/scripts/lint-files.sh` calls
   - Add single-file support: `/dd:lint README.md`
   - Add git workflow support: `/dd:lint --modified`, `/dd:lint --staged`
   - Preserve essential features: `--check-only`, `--verbose`, file patterns
3. **Integration testing**:
   - Test all usage patterns with unified backend
   - Verify performance and DD087 integration

### **SPRINT 3: Exception Handling** (DD089 - FUTURE ENHANCEMENT)

**Goal**: Advanced features for edge cases and teaching materials

**Week 3+ Tasks** (Lower Priority):

1. **Exception pattern design**:
   - Inline disable: `<!-- markdownlint-disable -->`
   - Context-aware detection for examples and teaching materials
2. **Unified script enhancement**:
   - Add exception parsing to `dev-tools/scripts/lint-files.sh`
   - Validation and reporting of skipped sections
3. **Command integration and testing**:
   - Update all `/dd:*` commands for exception support
   - Documentation and usage guidelines

## 🎉 Epic Deliverable

**Complete DOH Linting System** providing:

### **For Developers**:

- **Predictable behavior**: Clear rules, no surprises
- **Fast feedback**: Auto-correction fixes 99%+ issues instantly
- **Flexibility**: Can mark intentional errors, examples
- **Integration**: Works seamlessly with all DOH commands

### **For Commands**:

- **Unified backend**: All commands use `dev-tools/scripts/lint-files.sh`
- **STRICT enforcement**: Single enforcement point via git pre-commit hooks
- **Performance**: <1 second per-file linting operations
- **Consistency**: Same rules, same tools, same behavior across all entry points
- **Simplicity**: No more AI pipelines, pattern learning, or complex decision trees

### **For Project Quality**:

- **100% coverage**: All files linted (except explicit exceptions)
- **Zero false positives**: Exception handling eliminates inappropriate blocks
- **Maintainability**: Single shared codebase, clear architecture
- **Scalability**: Foundation for future linting enhancements

**Epic Success**: From complex dual-system to intelligent, self-improving, predictable linting workflow with unified
backend, exception handling, and continuous learning system that approaches 99%+ automation rate.

## 📈 Epic Metrics

**Quality Targets**:

- 99%+ auto-correction rate (Prettier → markdownlint --fix → codespell + custom rules)
- <1 second single-file linting performance via `dev-tools/scripts/lint-files.sh`
- Zero dual-system complexity (single enforcement point only)
- <1% manual intervention rate through intelligent feedback learning (DD103)
- 100% developer satisfaction with predictable STRICT behavior

**Integration Targets**:

- `/dd:commit --split`: Uses `lint-files.sh --staged` for clean per-commit enforcement
- `/dd:changelog`: Pure documentation updates (NO linting complexity)
- `/dd:lint`: Simple wrapper around `lint-files.sh` with pattern support
- Pre-commit hooks: Single source of linting truth across entire project
- Developer workflow: Clear rules - linting fails → commit blocked (unless --force)

**EDD098 Epic**: Foundation for perfect DOH development workflow quality assurance 🎯
