# T061 - Natural Language Router for /doh Commands 🗣️

**Status**: READY  
**Priority**: HIGH - Enhanced User Experience  
**Dependencies**: T002 (Core /doh Commands), T059 (AI Task Engine)  
**Epic**: E001 DOH Version 1.4.0 Release - Phase 3  
**Tags**: `#features` `#runtime` `#nlp` `#ux`  
**Estimated Effort**: 3-4 hours  
**Created**: 2025-08-28  
**Target Version**: 1.4.0  

## 📋 Description

Implement a natural language understanding layer for the /doh command that interprets user intent and automatically delegates to appropriate sub-commands. This creates a conversational interface where users can interact with DOH using natural language instead of memorizing specific command syntax.

## 🎯 Problem Statement

Currently, users must know exact command syntax:

- `/doh:next` for task recommendations
- `/doh:commit` for pipeline execution
- `/doh:analyze` for codebase analysis

This task enables natural language interactions:

- `/doh what should I work on?` → delegates to `/doh:next`
- `/doh commit my changes` → delegates to `/doh:commit`
- `/doh analyze this project` → delegates to `/doh:analyze`

## Core Functionality

### Natural Language Router

The `/doh` command becomes an intelligent dispatcher that:

1. **Interprets Intent**: Understands what the user wants to do
2. **Maps to Commands**: Identifies the appropriate /doh:* command
3. **Transforms Arguments**: Converts natural language to command parameters
4. **Delegates Execution**: Calls the target command with proper arguments
5. **Formats Response**: Presents results in conversational style

## Tasks

### Phase 1: Intent Recognition Engine (1h)

- [ ] **Design intent patterns** for common DOH operations
- [ ] **Create command mapping** from intents to /doh:* commands
- [ ] **Implement NLP parsing** for user queries
- [ ] **Build confidence scoring** for intent matching

### Phase 2: Command Delegation System (1h)

- [ ] **Implement command dispatcher** architecture
- [ ] **Create argument transformation** from NL to command params
- [ ] **Build command chaining** for complex requests
- [ ] **Add fallback handling** for ambiguous queries

### Phase 3: Common Intent Patterns (1h)

- [ ] **Task management intents** (next, what to do, recommendations)
- [ ] **Commit/pipeline intents** (commit, save, push changes)
- [ ] **Analysis intents** (analyze, examine, understand)
- [ ] **Query intents** (show tasks, list epics, status)
- [ ] **Help intents** (how to, what does, explain)

### Phase 4: Testing & Documentation (1h)

- [ ] **Test intent recognition** with various phrasings
- [ ] **Validate delegation accuracy** across commands
- [ ] **Document NL patterns** in inclaude.md
- [ ] **Create usage examples** for common scenarios

## Intent Pattern Mapping

### Task Recommendations

```
"what should I work on?" → /doh:next
"what's next?" → /doh:next
"show me high priority tasks" → /doh:next --context=priority
"I have 2 hours free" → /doh:next "I have 2 hours"
"what can I do that's quick?" → /doh:next --context=quick
```

### Commit Pipeline

```
"commit my changes" → /doh:commit
"save my work" → /doh:commit
"commit with message X" → /doh:commit "X"
"update changelog and commit" → /doh:changelog && /doh:commit
```

### Project Analysis

```
"analyze this project" → /doh:analyze
"understand the codebase" → /doh:analyze
"show me the architecture" → /doh:analyze --focus=architecture
"what does this project do?" → /doh:analyze --summary
```

### Task Management

```
"create a new task" → /doh:task:new
"show my tasks" → /doh:task:list
"complete task 123" → /doh:task:complete 123
"what's the status of epic 1?" → /doh:epic:status 1
```

### Help & Information

```
"help" → /doh:help
"what can you do?" → /doh:capabilities
"how do I create an epic?" → /doh:help epic:new
"explain DOH workflow" → /doh:docs workflow
```

## Technical Architecture

### Intent Recognition Pipeline

```
User Input → Tokenization → Pattern Matching → Intent Classification → Confidence Scoring → Command Selection
```

### Delegation Flow

1. **Parse Natural Language**: Extract intent and entities
2. **Match Intent Pattern**: Find best matching command pattern
3. **Transform Arguments**: Convert NL entities to command parameters
4. **Execute Delegation**: Call target command with arguments
5. **Handle Response**: Format and return results

### Confidence Thresholds

- **High (>0.8)**: Execute immediately
- **Medium (0.5-0.8)**: Confirm with user
- **Low (<0.5)**: Suggest alternatives

### Multi-Command Support

Handle complex requests that require multiple commands:

```
"analyze the project and show me what to work on"
→ /doh:analyze && /doh:next

"fix the linting issues and commit"
→ /doh:lint --fix && /doh:commit
```

## Implementation Strategy

### Pattern Library

Create comprehensive pattern library for intent matching:

```javascript
const patterns = {
  next: [
    /what.*(?:should|can).*(?:work|do)/i,
    /what'?s?\s+next/i,
    /recommend.*tasks?/i,
    /suggest.*work/i
  ],
  commit: [
    /commit/i,
    /save.*(?:work|changes)/i,
    /push.*changes/i
  ],
  // ... more patterns
};
```

### Entity Extraction

Extract parameters from natural language:

- Time expressions: "2 hours", "today", "this week"
- Priorities: "high priority", "urgent", "quick"
- Contexts: "testing", "documentation", "features"
- IDs: "task 123", "epic 1", "DOH-456"

### Conversational Context

Maintain conversation state for follow-ups:

```
User: "what should I work on?"
Bot: [shows recommendations]
User: "tell me more about the second one"
Bot: [delegates to /doh:task:detail with remembered context]
```

## Success Criteria

- [ ] **Natural language works** for common DOH operations
- [ ] **Delegation accurate** >90% for documented patterns
- [ ] **Graceful fallbacks** for ambiguous queries
- [ ] **Multi-command chains** execute correctly
- [ ] **Performance impact** <100ms for routing decision

## Benefits

- **Lower Learning Curve**: Users don't need to memorize commands
- **Faster Interactions**: Natural language often quicker than syntax
- **Better Discovery**: Users discover features through conversation
- **Flexible Input**: Multiple ways to express same intent
- **Progressive Disclosure**: Start simple, learn advanced features over time

## Example Interactions

### Simple Delegation

```bash
/doh what's next?
# Routes to: /doh:next
# Returns task recommendations
```

### Parameter Extraction

```bash
/doh show me quick documentation tasks
# Routes to: /doh:next --context=docs "quick"
# Returns filtered recommendations
```

### Multi-Command Chain

```bash
/doh update the changelog and commit with message "fixed bug"
# Routes to: /doh:changelog && /doh:commit "fixed bug"
# Executes pipeline
```

### Conversational Flow

```bash
/doh help me understand this project
# Routes to: /doh:analyze --summary
# Shows project overview

/doh what technologies does it use?
# Routes to: /doh:analyze --focus=stack
# Shows tech stack (context maintained)
```

### Ambiguity Handling

```bash
/doh next
# Bot: "Did you mean:
#  1. Show next tasks (/doh:next)
#  2. Go to next page (/doh:page:next)
#  3. Next sprint planning (/doh:sprint:next)"
# User selects or clarifies
```

## Future Enhancements

- **Learning**: Track successful patterns and improve matching
- **Shortcuts**: Learn user preferences and create personal shortcuts
- **Batch Operations**: Handle multiple operations in one command
- **Context Awareness**: Use project state to inform routing
- **Proactive Suggestions**: Suggest relevant commands based on context

## Deliverable

A natural language router for the /doh command that interprets user intent and seamlessly delegates to appropriate sub-commands, creating a conversational interface that makes DOH accessible to users without requiring command syntax memorization while maintaining full access to all DOH capabilities.

---
