# DD091 - Implement PM Agent for Task Creation and /dd:next Optimization

**Status**: PROPOSED  
**Priority**: HIGH  
**Dependencies**: DD090 (Agent Architecture Design)  
**Epic**: EDD075 (DOH-DEV Internal System)

Implement specialized PM Agent (Product Manager) for intelligent task creation, /dd:next optimization, and architectural
software guidance with optimized context memory management.

## 🎯 Goal

Transform task creation and /dd:next from generalist Claude responses into specialized PM Agent interactions focused on:

- **Architectural software decisions**
- **Strategic task planning**
- **Optimized context memory** (avoid polluting global Claude console)

## 📋 Current Problems

1. **Generalist responses**: `/dd:next` uses basic Claude instead of PM Agent specialist
2. **Task creation inefficiency**: No architectural guidance when creating new tasks
3. **Context pollution**: Long agent conversations clutter the main Claude console
4. **Missing strategic vision**: Lack of product manager perspective on priorities
5. **CLAUDE.md outdated**: Current instructions don't reflect agent-oriented workflow and TODO-first development
   philosophy
6. **Console role confusion**: Main console performs coding instead of coordination (should route to Senior Dev Agent)

## 🧠 PM Agent Specialization Requirements

### Core Capabilities

- **Architectural thinking**: Evaluate technical decisions with system design perspective
- **Task decomposition**: Break complex requirements into actionable T### tasks
- **Strategic prioritization**: Balance technical debt vs features vs quality
- **Dependency analysis**: Identify blockers and critical paths
- **Resource optimization**: Consider effort/impact ratios

### Personality Profile

- **Proactive**: Asks clarifying questions about requirements
- **Systematic**: Thinks in epics, features, tasks hierarchy
- **Risk-aware**: Identifies potential issues early
- **Business-focused**: Considers user value and project goals

## 🚀 Implementation Strategy

### Phase 1: PM Agent Core (High Priority)

#### Task 1.1: Create PM Agent Prompt Template

```markdown
# PM Agent System Prompt

You are a specialized Product Manager Agent for DOH-DEV system.

**Role**: Strategic project planning and architectural guidance **Focus**: Task creation, priority analysis, system
architecture decisions **Personality**: Proactive, systematic, asks clarifying questions

**Capabilities**:

- Break down complex requirements into T### tasks
- Analyze technical architecture implications
- Prioritize based on impact/effort/dependencies
- Identify risks and mitigation strategies
- Suggest implementation approaches

**Context**: DOH system development (DevOps Helper for Claude.ai users) **Current State**: [Dynamic project state
injection]
```

#### Task 1.2: Implement PM Agent Routing

- Detect when user asks for task creation help
- Route to PM Agent instead of general Claude
- Triggers: "create task", "need help with", "/dd:next", architectural questions

#### Task 1.3: Context Memory Optimization

```bash
# Separate PM Agent workspace to avoid console pollution
.claude/agents/pm/
├── context.md          # Current project state
├── conversation.md     # PM Agent conversation history
├── decisions.md        # Architectural decisions log
└── task-pipeline.md    # Generated tasks pending approval
```

### Phase 2: Integration with /dd:next

#### Task 2.1: Modify /dd:next Command

- Replace generalist analysis with PM Agent call
- PM Agent analyzes todo/ structure
- Returns strategic recommendations with architectural context

#### Task 2.2: Smart Context Injection

- PM Agent gets curated project context (not full codebase)
- Essential info only: current epics, active tasks, recent completions
- Avoid overwhelming agent with irrelevant details

### Phase 3: Enhanced Workflows

#### Task 3.1: Task Creation Assistant

```bash
# New workflow:
User: "I need to implement user authentication"
→ PM Agent: Analyzes requirements, asks clarifying questions
→ PM Agent: Creates E### epic with T### breakdown
→ PM Agent: Suggests implementation approach and priorities
```

#### Task 3.2: Architectural Decision Support

- PM Agent helps with technical architecture choices
- Considers DOH system constraints and goals
- Provides reasoning for recommendations

## 💡 Context Memory Optimization Brainstorm

### Problem: Context Pollution

- Long agent conversations fill main Claude console
- Hard to track main development work
- Context switching overhead

### Solution Ideas

#### Option A: Separate Agent Console

```bash
/dd:pm "help me plan authentication system"
# Opens separate PM Agent conversation thread
# Results returned to main console as summary
```

#### Option B: Background Agent Processing

```bash
/dd:next → PM Agent processes silently → returns optimized results
# User sees only final recommendations, not agent reasoning
```

#### Option C: Contextual Memory Files

```bash
# PM Agent maintains its own memory files
.claude/agents/pm/memory.md  # Persistent agent context
.claude/agents/pm/active.md  # Current conversation state
# Main console stays clean, agent has continuity
```

#### Option D: Hybrid Approach (Recommended)

- **Silent processing** for routine /dd:next calls
- **Interactive mode** for complex task creation (`/dd:pm`)
- **Memory persistence** in agent-specific files
- **Context summarization** to avoid pollution

### Memory Architecture Design

```bash
.claude/agents/
├── pm/                 # Product Manager Agent
│   ├── system.md      # Agent prompt and personality
│   ├── context.md     # Current project state (auto-updated)
│   ├── memory.md      # Conversation history and decisions
│   └── pipeline.md    # Pending tasks and recommendations
├── senior-dev/        # Senior Developer Agent (future)
└── analyzer/          # Code Analyzer Agent (future)
```

### Context Optimization Rules

1. **Minimal Context Injection**: Only essential project info to agents
2. **Focused Memory**: Agent-specific memory files, not shared state
3. **Clean Console**: Main Claude console sees only results, not reasoning
4. **Persistent Continuity**: Agents remember previous decisions across sessions

## 🔧 Technical Implementation

### PM Agent Integration Points

#### 1. /dd:next Enhancement

```bash
# Current behavior:
/dd:next --internal → Claude generalist analysis

# Enhanced behavior:
/dd:next --internal → PM Agent strategic analysis → optimized recommendations
```

#### 0. CLAUDE.md Update (PRIORITY)

```bash
# Update project instructions to reflect new philosophy
- Add agent-oriented development workflow
- Enforce TODO-first development: "better to ask than to work dans le vent"
- Document agent routing rules (PM Agent for planning, Senior Dev for coding)
- Add quality gates: no work without mature T### tasks
```

#### 2. Task Creation Commands

```bash
/dd:pm "design authentication system"  # Interactive PM Agent
/dd:task "quick task creation"         # PM Agent task generator
/dd:architect "technical decision"     # PM Agent architecture guidance
```

#### 3. Context Management

```bash
# Auto-updated PM Agent context
- Current epic status (from todo/ files)
- Recent completions and blockers
- Project goals and constraints
- Version targets (VDOH-1.4.0, VDD-0.1.0)
```

## 📊 Success Criteria

### Immediate Impact (Phase 1)

- ✅ PM Agent responds to task creation requests with architectural perspective
- ✅ /dd:next provides strategic recommendations instead of basic analysis
- ✅ Context memory optimized - main console stays clean
- ✅ Agent conversation isolated to dedicated workspace

### Medium-term Benefits (Phase 2-3)

- ✅ Higher quality task decomposition with proper epic/feature structure
- ✅ Better architectural decisions through specialized PM guidance
- ✅ Reduced context switching overhead for user
- ✅ Persistent agent memory across sessions

### Quality Gates

- **PM Agent recommendations** match DD090 personality profile
- **Context optimization** reduces main console pollution by 80%+
- **Task quality** improvement measurable in better task specifications
- **User workflow** enhanced through specialized agent interactions

## 🎯 Implementation Tasks

- [ ] **UPDATE CLAUDE.md** - Add agent-oriented and TODO-first development philosophy (PRIORITY)
- [ ] Create PM Agent system prompt and personality profile
- [ ] Implement agent routing logic for task creation scenarios
- [ ] Design context memory optimization architecture
- [ ] Create `.claude/agents/pm/` workspace structure
- [ ] Modify /dd:next to use PM Agent instead of generalist Claude
- [ ] Implement context injection system (minimal, focused data)
- [ ] Create PM Agent memory persistence system
- [ ] Add task creation commands (/dd:pm, /dd:task, /dd:architect)
- [ ] Enforce TODO-first workflow: never code without mature T### task
- [ ] Test PM Agent responses match DD090 specifications
- [ ] Validate context pollution reduction
- [ ] Document new PM Agent workflows with CLAUDE.md integration

## 🔄 Testing Scenarios

### Test 1: Task Creation

```
User: "I need to implement a plugin system for DOH"
Expected: PM Agent asks architectural questions, suggests epic breakdown
```

### Test 2: /dd:next Optimization

```
User: /dd:next --internal
Expected: PM Agent strategic analysis, not generalist response
```

### Test 3: Context Cleanliness

```
Expected: Main console shows only results, agent reasoning isolated
```

### Test 4: Memory Persistence

```
Expected: PM Agent remembers previous architectural decisions across sessions
```

## 📚 CLAUDE.md Integration Requirements

### Current CLAUDE.md Issues

- **No agent workflow guidance**: Instructions assume generalist Claude approach
- **Missing TODO-first philosophy**: Should enforce "never work without mature TODO"
- **Outdated development approach**: Doesn't reflect specialized agent architecture

### Required CLAUDE.md Updates

#### 1. Agent-Oriented Development Section

```markdown
## 🤖 Agent-Oriented Development Workflow

**CRITICAL PRINCIPLE**: This project uses specialized AI agents, not generalist Claude responses.

### Agent Routing Rules

- **Task Creation**: Use PM Agent via /dd:pm or /dd:task (not generalist Claude)
- **Code Implementation**: Use Senior Dev Agent (DD090 architecture)
- **Quality Analysis**: Use Code Analyzer Agent (DD090 architecture)
- **Strategic Planning**: PM Agent handles all architectural decisions

### Agent Context Isolation

- Each agent maintains separate memory files (.claude/agents/)
- Main console receives results only, not agent reasoning
- Agents have persistent context across sessions
```

#### 2. TODO-First Development Philosophy

```markdown
## 🎯 TODO-First Development (MANDATORY)

**CORE RULE**: "Never work without having a clear mature TODO"

### DOH-DEV Console Coding Policy

**🚫 CRITICAL**: Main console should NEVER perform coding - ALL development must use agents

- ✅ **ALWAYS**: Route ALL coding to Senior Dev Agent (no exceptions)
- ✅ **ALWAYS**: Main console focuses ONLY on planning, guidance, coordination
- ❌ **NEVER**: Write code directly in main console (even if user asks explicitly)
- ❌ **NEVER**: Skip agent routing for ANY implementation tasks
- ❌ **NEVER**: Exception for "explicit requests" - use agents for ALL development

### Development Prerequisites

- ✅ **ALWAYS**: Create T### task before any implementation work
- ✅ **ALWAYS**: Use PM Agent for task creation and architectural guidance
- ✅ **ALWAYS**: Use Senior Dev Agent for ALL coding tasks (no exceptions)
- ❌ **NEVER**: Code directly without structured TODO
- ❌ **NEVER**: Work "dans le vent" (without clear direction)
- ❌ **NEVER**: Main console coding (ZERO exceptions, even explicit requests)

### Decision Tree
```

User requests work → Does mature T### exist? ├── YES → Route to appropriate agent (Senior Dev for ALL coding) └── NO →
Route to PM Agent for task creation first

User requests coding → ANY coding request? ├── YES → Route to Senior Dev Agent (ALWAYS) └── NO → Continue with
planning/coordination

```

### Quality Gates
- No code commits without linked T### reference
- ALL coding routed through Senior Dev Agent (ZERO exceptions)
- All architectural decisions documented in PM Agent memory
- Task completion requires explicit deliverable validation
- Main console NEVER writes code - only coordinates agents
```

#### 3. Enhanced Development Guidelines

```markdown
## 🚀 DOH-DEV Enhanced Workflow

### Console Role Definition

**Main Console Purpose**: Strategic coordination, planning, and agent orchestration ONLY

- ✅ Planning and architecture discussions
- ✅ Task creation and prioritization
- ✅ Agent routing and coordination
- ✅ Results review and validation
- ❌ Direct coding implementation (ZERO exceptions - ALWAYS use agents)

### Before Any Coding

1. **Check for mature TODO**: Is there a well-defined T### task?
2. **If no TODO**: Route to PM Agent for strategic planning
3. **If TODO exists**: Validate it's mature enough (acceptance criteria, scope, dependencies)
4. **If TODO immature**: Enhance with PM Agent before proceeding
5. **For implementation**: Route to Senior Dev Agent (not main console)

### Agent Interaction Patterns

- **"I need to implement X"** → PM Agent creates Epic/Tasks breakdown
- **"How should I approach Y"** → PM Agent provides architectural guidance
- **"What should I work on"** → /dd:next with PM Agent strategic analysis
- **"Code this feature"** → Senior Dev Agent handles implementation
- **"Write me a script"** → Senior Dev Agent handles ALL coding (no exceptions)

### Context Management

- Agents maintain their own memory (.claude/agents/)
- Project state auto-injected to relevant agents
- Main Claude console stays focused on coordination, not implementation
- Coding work isolated to Senior Dev Agent workspace
```

## 🎁 Deliverable

A specialized PM Agent system that:

- Handles all task creation with architectural expertise
- Powers optimized /dd:next recommendations
- Maintains clean context separation from main Claude console
- Provides strategic project management perspective aligned with DD090 vision
- **Updates CLAUDE.md** with agent-oriented and TODO-first development philosophy

**Next Phase**: Implement remaining DD090 agents (Senior Dev, Code Analyzer, etc.)
