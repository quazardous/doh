# T082 - Implement Smart Cache Management for /dd:next with DOH-DEV Separation üìù

**Project**: DOH-DEV Internal  
**Status**: COMPLETED  
**Priority**: MEDIUM - Performance & Context Isolation  
**Dependencies**: T073 (--internal flag implementation)  
**Epic**: E075 DOH-DEV Internal System - Phase 1  
**Tags**: `#caching` `#performance` `#context-isolation` `#developer-experience` `#project-separation`  
**Estimated Effort**: 2-3 hours  
**Created**: 2025-08-28  
**Completed**: 2025-08-28  
**Proposed Version**: dd-0.2.0

## üìã Description

Enhance `/dd:next` to properly utilize its smart memory cache system with dedicated cache files for DOH-DEV Internal vs DOH Runtime contexts, ensuring cache consistency and optimal performance with project isolation.

## üéØ Problem Statement

**Current Cache Issues**:
- `/dd:next` has cache system defined but implementation unclear
- Single `todo/NEXT.md` cache doesn't distinguish between DOH-DEV and DOH Runtime contexts
- `--internal` flag may not properly utilize or update separate cache data
- Cache performance benefits not fully realized due to context mixing

**Target Solution**:
- **Ensure `todo/NEXT.md`** is properly utilized for default (DOH Runtime) recommendations
- **Create `todo/NEXT-dd.md`** for `--internal` flag DOH-DEV specific cache
- **Project-aware caching** that maintains context isolation
- **Cache validation** and automatic refresh when source files change

## Core Functionality

### 1. Dual Cache System Architecture

**Cache File Strategy**:
```bash
todo/
‚îú‚îÄ‚îÄ NEXT.md        # Default cache (DOH Runtime focus - doh-1.4.0 tasks)
‚îî‚îÄ‚îÄ NEXT-dd.md     # DOH-DEV cache (Internal focus - dd-0.1.0 tasks)
```

**Context-Aware Cache Selection**:
```bash
# Default behavior - uses todo/NEXT.md
/dd:next
/dd:next "quick wins"
/dd:next --context=docs

# DOH-DEV Internal - uses todo/NEXT-dd.md  
/dd:next --internal
/dd:next --internal "command enhancements"
/dd:next --project=doh-dev --context=testing
```

### 2. Cache Content Structure

**`todo/NEXT.md` (DOH Runtime Cache)**:
```markdown
# /dd:next Smart Memory Cache - DOH Runtime

**Last Updated**: 2025-08-28 14:30 UTC  
**Project Focus**: DOH Runtime (doh-1.4.0)  
**Task Scope**: End-user features, public distribution, runtime functionality  
**Source Analysis**: 35 DOH Runtime tasks, 12 ready to start

## Pre-computed Query Results

### "quick wins" 
- T037 (1-2h): Clean up old project references (#doc, High Priority)
- T008 (2h): Integrate CLAUDE.md instructions (#doc, Medium Priority)  
- T056 (1.5h): Update README examples (#doc, Medium Priority)

### "high impact"
- T032 (4h): Design build system architecture (blocks T003, T005, T054)
- T054 (3h): Implement core distribution logic (Epic E001 critical path)
- T027 (2-4h): Markdown linting system (enables quality automation)

### "documentation tasks"
- T037: Project reference cleanup (ready, high priority)  
- T008: CLAUDE.md integration (ready, medium priority)
- T056: README examples update (ready, medium priority)
- T019: Documentation structure review (waiting on T037)

## Task Classification

### Ready to Start (12 tasks)
- DOH Runtime tasks with no dependencies
- Focus on doh-1.4.0 version goals
- Excludes internal development concerns

### Dependency Analysis  
- T032 blocks: T003, T005, T054 (build system cascade)
- T037 enables: T034 Phase 3, T019, general doc quality
- T054 critical path: Epic E001 completion

## Version Context
- **Current Version**: doh-1.4.0-dev
- **Must Have**: Core functionality, distribution system, user documentation
- **Should NOT Have**: External API dependencies, complex integrations
```

**`todo/NEXT-dd.md` (DOH-DEV Internal Cache)**:
```markdown
# /dd:next Smart Memory Cache - DOH-DEV Internal

**Last Updated**: 2025-08-28 14:30 UTC  
**Project Focus**: DOH-DEV Internal (dd-0.1.0)  
**Task Scope**: Internal tooling, /dd:* commands, developer experience  
**Source Analysis**: 8 DOH-DEV Internal tasks, 3 ready to start

## Pre-computed Query Results

### "internal tooling improvements"
- T078 (1.5-2h): Enhance /dd:lint with T070 intelligence (#linting, Medium Priority)
- T080 (2-2.5h): Optimize /dd:* command descriptions for Claude AI (#ai-interface, Medium Priority)

### "command enhancements"  
- T078: /dd:lint intelligence integration (ready, builds on T070)
- T080: Claude AI command optimization (ready, no dependencies)

### "quick wins"
- T078: Leverage existing T070 feedback system (1.5-2h, ready)

## Task Classification

### Ready to Start (2 tasks)
- T078: /dd:lint enhancement (dependencies: T070 ‚úÖ completed)
- T080: Command description optimization (no dependencies)

### Recently Completed
- T073: --internal flag for /dd:next (COMPLETED 2025-08-28)
- T070: AI-powered linting pipeline (COMPLETED 2025-08-28)  
- T079: Numbering analysis and documentation (COMPLETED 2025-08-28)
- T081: AI documentation management /dd:mkai (COMPLETED 2025-08-28)

## Version Context
- **Current Version**: dd-0.1.0 (~30% complete)
- **Must Have**: Project context isolation, enhanced /dd:* commands, developer experience
- **Should NOT Have**: Runtime distribution features, end-user functionality, external dependencies
```

### 3. Cache Management Operations

**Cache Validation & Refresh**:
```bash
# Check if cache is current
if [[ todo/*.md -nt todo/NEXT.md ]]; then
  echo "üîÑ Cache refresh needed - source files modified"
  refreshCache "runtime"
fi

if [[ todo/T*.md -nt todo/NEXT-dd.md ]] && hasInternalTasks; then
  echo "üîÑ DOH-DEV cache refresh needed"  
  refreshCache "doh-dev"
fi
```

**Smart Cache Usage**:
```bash
# Cache-only mode with proper file selection
/dd:next --cache-only              # Uses todo/NEXT.md
/dd:next --internal --cache-only   # Uses todo/NEXT-dd.md  

# Force refresh specific cache
/dd:next --refresh                 # Refreshes todo/NEXT.md
/dd:next --internal --refresh      # Refreshes todo/NEXT-dd.md
```

### 4. Performance Optimization Features

**Intelligent Cache Updates**:
- **Incremental updates**: Only refresh sections that changed
- **Timestamp tracking**: Avoid unnecessary re-computation
- **Project-aware analysis**: Only analyze relevant tasks for each cache
- **Query pre-computation**: Popular queries pre-calculated for instant response

**Cache Consistency**:
- **Source file monitoring**: Detect when todo/*.md files change
- **Automatic invalidation**: Clear cache when source analysis needed
- **Cross-cache coordination**: Ensure both caches stay synchronized with shared data
- **Recovery mechanisms**: Rebuild cache if corruption detected

## Implementation Tasks

### Phase 1: Cache Architecture Setup (1h)

**A. Create NEXT-dd.md Structure**
- [ ] **Create `todo/NEXT-dd.md`** with DOH-DEV Internal focus template
- [ ] **Add project classification logic** to distinguish cache contexts
- [ ] **Implement cache file selection** based on `--internal` flag
- [ ] **Add cache validation** to ensure proper file utilization

**B. Enhance Cache Content**
- [ ] **Populate pre-computed queries** for common DOH-DEV patterns
- [ ] **Add task classification** with ready/blocked/completed sections  
- [ ] **Include dependency analysis** specific to internal development
- [ ] **Add version context** for dd-0.1.0 goals and constraints

### Phase 2: Cache Management Logic (1h)

**A. Smart Cache Operations**
- [ ] **Implement cache refresh detection** based on source file timestamps
- [ ] **Add project-aware refresh logic** (refresh only relevant cache)
- [ ] **Create incremental update system** to avoid full re-computation
- [ ] **Add cache corruption recovery** with automatic rebuild

**B. Performance Optimization**
- [ ] **Optimize cache-only mode** for sub-100ms responses from correct cache
- [ ] **Pre-compute common queries** for both runtime and internal contexts
- [ ] **Implement smart invalidation** to maintain cache accuracy
- [ ] **Add performance monitoring** to track cache hit rates

### Phase 3: Integration & Testing (45min)

**A. Flag Integration**
- [ ] **Test `--cache-only` with both cache files** (NEXT.md vs NEXT-dd.md)
- [ ] **Verify `--refresh` updates correct cache** based on context
- [ ] **Ensure `--internal` properly uses NEXT-dd.md** in all modes
- [ ] **Test combined flags** like `--internal --cache-only --context=testing`

**B. Quality Assurance**
- [ ] **Verify cache consistency** between runtime and internal contexts
- [ ] **Test cache performance** with large task sets
- [ ] **Validate project isolation** in cache content
- [ ] **Check backward compatibility** with existing cache usage

### Phase 4: Documentation & Enhancement (15min)

**A. Command Documentation Update**
- [ ] **Update `/dd:next` command help** with cache behavior explanation
- [ ] **Add cache management examples** in command documentation
- [ ] **Document performance characteristics** for different cache modes
- [ ] **Explain project separation** in cache architecture

**B. Usage Examples**
- [ ] **Create cache workflow examples** for both contexts
- [ ] **Add troubleshooting guide** for cache issues
- [ ] **Document cache maintenance** procedures
- [ ] **Add performance tuning tips** for optimal cache usage

## Expected Performance Improvements

### Response Time Targets
- **Cache hit (--cache-only)**: <100ms for both NEXT.md and NEXT-dd.md
- **Standard mode**: 1-2 seconds with smart cache validation  
- **Refresh mode**: 3-5 seconds with optimized analysis scope
- **Memory efficiency**: Separate caches reduce analysis overhead

### User Experience Benefits
- **Context isolation**: DOH-DEV recommendations don't mix with runtime tasks
- **Faster workflows**: Sub-100ms responses for rapid development iterations
- **Project awareness**: Cache content matches development context exactly
- **Consistency**: Reliable performance regardless of total task count

## Success Criteria

### Core Cache Functionality
- [ ] **`todo/NEXT.md` properly utilized** for default DOH Runtime recommendations
- [ ] **`todo/NEXT-dd.md` created and used** for `--internal` flag DOH-DEV context
- [ ] **Cache-only mode achieves <100ms** response times from correct cache file
- [ ] **Cache refresh works correctly** for both runtime and internal contexts

### Project Isolation
- [ ] **DOH Runtime cache contains only** relevant doh-1.4.0 tasks and context
- [ ] **DOH-DEV cache contains only** relevant dd-0.1.0 internal tasks and context  
- [ ] **No cross-contamination** between runtime and internal cache content
- [ ] **Project-appropriate recommendations** based on cache context

### Performance & Reliability
- [ ] **Automatic cache invalidation** when source files change
- [ ] **Graceful degradation** if cache files missing or corrupted
- [ ] **Consistent performance** regardless of total task count
- [ ] **Backward compatibility** maintained with existing workflows

### Quality Assurance
- [ ] **Cache content accuracy** verified against source todo/*.md files
- [ ] **Pre-computed queries** match real-time analysis results
- [ ] **Project classification** correctly identifies internal vs runtime tasks
- [ ] **Documentation updated** to reflect cache architecture and usage

## Integration Points

- **Builds on**: T073 (--internal flag implementation) for project context switching
- **Enhances**: Existing `/dd:next` smart memory system with proper utilization
- **Supports**: DOH-DEV vs DOH Runtime project isolation philosophy
- **Enables**: High-performance task recommendations with context awareness
- **Integrates**: With other `/dd:*` commands that may benefit from cache patterns

## Benefits & Impact

### Developer Experience
- **Faster recommendations**: Sub-100ms responses for routine workflow queries
- **Better context**: Recommendations match actual development focus (internal vs runtime)
- **Consistent performance**: Reliable speed regardless of project size
- **Smart automation**: Cache automatically maintains itself with minimal overhead

### Project Quality
- **Context isolation**: Prevents mixing internal tooling with runtime feature work
- **Resource efficiency**: Separate caches reduce memory and computation overhead
- **Scalability**: Performance remains consistent as project grows
- **Maintainability**: Clear separation of concerns in cache architecture

### Technical Foundation
- **Cache system foundation**: Establishes pattern for other commands needing memory
- **Performance benchmark**: Demonstrates sub-100ms AI-powered command capability
- **Project awareness**: Template for other context-sensitive DOH-DEV tools
- **Quality assurance**: Reliable caching system with automatic validation

---

Cette t√¢che assure que `/dd:next` utilise efficacement son syst√®me de cache intelligent tout en maintenant l'isolation parfaite entre les contextes DOH-DEV Internal et DOH Runtime.