# DD110: Plugin Testing Framework for Linting System

**Status**: PROPOSED  
**Priority**: MEDIUM  
**Assigned**: Claude  
**Created**: 2025-08-29  
**Type**: Testing Infrastructure  
**Depends on**: DD109 (Cache Restructuring and AI Plugin System)

## Objective

Implement a testing framework for linting plugins to ensure plugin functionality, configuration merging, and rollback capabilities work correctly before deployment.

## Problem Statement

The new plugin system (DD109) needs automated testing to:

- Validate plugin installation/uninstallation
- Test configuration merging without breaking existing configs
- Verify rollback mechanisms work correctly
- Ensure plugins actually fix the targeted errors
- Test plugin compatibility across different linter versions

## Solution Design

### Plugin Test Structure

Each plugin should have a `tests/` subdirectory:

```text
./linting/plugins.d/markdownlint/md040-yaml-blocks/
â”œâ”€â”€ README.md
â”œâ”€â”€ STATUS
â”œâ”€â”€ config-fragment.json
â”œâ”€â”€ detect-yaml.js
â””â”€â”€ tests/                          # New test directory
    â”œâ”€â”€ test-cases.md               # Sample files with target errors
    â”œâ”€â”€ expected-results.md         # Expected output after plugin
    â”œâ”€â”€ test-config.json            # Test configuration
    â””â”€â”€ plugin-test.sh              # Plugin-specific test script
```

### Test Framework Components

**Main Test Runner**: `test-plugins.sh`
```bash
# Test all plugins
./linting/test-plugins.sh

# Test specific linter plugins  
./linting/test-plugins.sh markdownlint

# Test specific plugin
./linting/test-plugins.sh markdownlint:md040-yaml-blocks
```

**Test Categories**:

1. **Installation Tests**: Verify config merging works correctly
2. **Functionality Tests**: Plugin actually fixes targeted errors
3. **Rollback Tests**: Disable/remove works without breaking configs
4. **Compatibility Tests**: Works with different linter versions
5. **Integration Tests**: Multiple plugins work together

### Test Implementation

**Per-Plugin Test Script** (`plugin-test.sh`):
```bash
#!/bin/bash
# Test script for md040-yaml-blocks plugin

test_installation() {
    # Backup original config
    # Install plugin
    # Verify config merge successful
}

test_functionality() {
    # Run linter on test-cases.md
    # Verify errors are fixed
    # Compare with expected-results.md
}

test_rollback() {
    # Disable plugin
    # Verify config restored
    # No broken configurations
}
```

**Test Cases per Plugin**:
```markdown
# test-cases.md - Sample content with target errors

```
key: value
list:
  - item1
  - item2
```

This should trigger MD040 error and be fixed by plugin.
```

## Tasks

- [ ] Create test framework structure in `./linting/tests/`
- [ ] Implement main test runner `test-plugins.sh`
- [ ] Create test templates for each linter type
- [ ] Add `tests/` subdirectory to existing plugin examples
- [ ] Implement plugin-specific test scripts
- [ ] Add CI integration for plugin testing
- [ ] Create test case generators based on error cache patterns
- [ ] Document testing procedures in plugin README templates

## Integration Points

- **DD109**: Uses plugin structure created in cache restructuring
- **CI/CD**: Automated testing before plugin deployment
- **Plugin Managers**: Test integration with manager scripts
- **Error Cache**: Generate test cases from real error patterns

## Files to Create

- `./linting/tests/test-plugins.sh` - Main test runner
- `./linting/tests/plugin-test-template.sh` - Template for plugin tests
- `./linting/tests/README.md` - Testing documentation
- Plugin-specific test directories with sample files

## Benefits

- ðŸ§ª **Quality Assurance**: Verify plugins work before human approval
- ðŸ”„ **Safe Rollback**: Test disable/remove operations thoroughly
- âš¡ **Fast Validation**: Automated testing of plugin effectiveness
- ðŸŽ¯ **Real-World Testing**: Use actual error patterns from cache
- ðŸ¤– **CI Integration**: Block bad plugins from being deployed

## Success Criteria

- [ ] All plugins have comprehensive test suites
- [ ] Test runner validates installation/functionality/rollback
- [ ] CI automatically tests plugins before approval
- [ ] Test cases generated from real project error patterns
- [ ] Zero broken configurations after plugin operations

## Notes

This testing framework ensures the plugin system is reliable and safe to use, preventing configuration breakage and validating that plugins actually solve the problems they target.