# T073: Add --internal Flag to /dd:next Command

**Priority**: Medium  
**Status**: COMPLETED (2025-08-28)  
**Actual effort**: 1.5 hours  

## Objective

Enhance `/dd:next` command with `--internal` flag to focus task recommendations on DOH-DEV internal development and tooling, while making DOH runtime user features the default focus.

## Background

Currently `/dd:next` analyzes all tasks without distinguishing between:
- **DOH-DEV Internal**: Tool development, dd-x.x.x versioned enhancements, internal workflow improvements
- **DOH Runtime**: End-user features, doh-x.x.x versioned functionality, public distribution features

This flag will provide targeted recommendations based on development context.

## Requirements

### Flag Behavior
- `--internal`: Focus on DOH-DEV internal development tasks (dd-x.x.x versioning)
- **Default** (no flag): Focus on DOH runtime user features (doh-x.x.x versioning)
- `--project=all`: Maintain current behavior showing both with separation

### Task Classification Logic
- **DOH-DEV Internal** indicators:
  - Tasks tagged with version files `dd-*.md`
  - Internal tooling improvements (command enhancements, development workflow)
  - Build system, testing framework, development process improvements

- **DOH Runtime** indicators:
  - Tasks tagged with version files `doh-*.md`
  - Tasks belonging to existing epics focused on end-user features
  - Public distribution features, user-facing functionality
  - Documentation for end users, runtime stability improvements

### Implementation Points

1. **Update command documentation** in `.claude/commands/dd/next.md`
2. **Add flag parsing** to handle `--internal` parameter
3. **Implement task filtering logic** based on version file associations and epic membership
4. **Update smart memory system** in `todo/NEXT.md` to include internal/runtime classification
5. **Enhance natural language processing** to recognize internal vs runtime context in queries
6. **Update examples and usage patterns** to demonstrate the new filtering capability

## Expected Output Examples

```bash
# Default behavior - focus on DOH runtime features
/dd:next
# Returns: Tasks from doh-1.4.0.md, user-facing features, public distribution

# Internal development focus
/dd:next --internal  
# Returns: Tasks from dd-0.1.0.md, tooling improvements, dev workflow

# Natural language with context
/dd:next "internal tooling improvements"
# Auto-maps to --internal flag behavior

# Combined with other flags
/dd:next --internal --context=testing --format=detailed
# Internal testing tools and QA improvements with detailed analysis
```

## Success Criteria

- [x] `--internal` flag properly filters for DOH-DEV internal tasks
- [x] Default behavior focuses on DOH runtime without flag
- [x] Smart memory system correctly classifies tasks by project type
- [x] Natural language queries recognize internal vs runtime context
- [x] Documentation updated with clear examples and usage patterns
- [x] Command maintains backward compatibility with existing usage

## Implementation Summary

**Completed Work:**
- **Enhanced command usage**: Added `--internal` flag to `/dd:next` usage syntax
- **Added convenient shorthand**: `--internal` equivalent to `--project=doh-dev` for streamlined workflow
- **Updated parameter documentation**: Clear explanation of DOH-DEV vs DOH Runtime focus
- **Enhanced natural language processing**: Auto-mapping of "internal development" queries to `--internal` flag
- **Added comprehensive examples**: Quick start patterns, smart flag combinations, query interpretations
- **Updated AI analysis engine**: Project classification with version file indicators (dd-*.md vs doh-*.md)
- **Enhanced smart memory**: Pre-computed internal/runtime task categorization
- **Added response format examples**: Dedicated Internal Development Format showing DOH-DEV tasks

**Technical Implementation:**
- Flag parsing for `--internal` parameter
- Task classification logic based on version file associations
- Natural language query recognition for internal vs runtime context
- Smart memory updates to include project type classification
- Backward compatibility maintained with existing `--project` flag

## Dependencies

- **Depends on**: Current `/dd:next` command functionality
- **Blocks**: None (enhancement to existing command)

## Notes

This enhancement supports the project's dual nature:
- **DOH-DEV**: Internal development tooling (this repository's enhancement)
- **DOH Runtime**: End-user distributed functionality

The `--internal` flag provides focused recommendations for contributors working on the DOH system itself, while default behavior serves users implementing DOH in their projects.