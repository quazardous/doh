# DOH063 - Refactor Build Architecture: Separate Runtime from Development ğŸ—ï¸

**Status**: READY  
**Priority**: MEDIUM - Architectural Preparation  
**Dependencies**: DOH032 (Runtime Build Process), DOH003 (Architecture & Distribution)  
**Epic**: Pre-Version 2.0 - Architectural Foundation  
**Tags**: `#architecture` `#build` `#separation` `#v2-prep`  
**Estimated Effort**: 4-6 hours  
**Created**: 2025-08-28  
**Proposed Version**: 2.0.0

## ğŸ“‹ Description

Refactor the DOH build architecture to completely separate /doh runtime distribution from the /doh-sys development
project. This architectural change prepares for DOH 2.0 by establishing clear boundaries between development tooling and
runtime distribution, eliminating the current mixing of concerns.

## ğŸ¯ Problem Statement

Currently, the /doh-sys development project includes runtime components mixed with development infrastructure:

**Current Architecture Issues**:

- `/doh` runtime commands exist within the `/doh-sys` development project
- Build process creates runtime distributions from development codebase
- No clear separation between "developing DOH" vs "using DOH"
- Distribution artifacts include development-specific files and patterns

**Future State Goal**:

- Clean separation: /doh-sys for developing DOH, /doh runtime distributed separately
- Runtime distribution contains only user-facing components
- Development project focuses purely on DOH system development
- Clear architectural boundaries for maintainability and scaling

## Core Architectural Changes

### 1. Current Mixed Architecture

```
/doh-sys project (development + runtime mixed):
â”œâ”€â”€ .claude/commands/doh-sys/     # Development commands âœ“
â”œâ”€â”€ .claude/commands/doh/         # Runtime commands (âŒ should be separate)
â”œâ”€â”€ .claude/doh/                  # Runtime templates (âŒ should be separate)
â”œâ”€â”€ todo/                         # Development tasks âœ“
â”œâ”€â”€ DEVELOPMENT.md                # Development docs âœ“
â””â”€â”€ build-scripts/                # Creates mixed distributions âŒ
```

### 2. Target Separated Architecture

```
/doh-sys project (pure development):
â”œâ”€â”€ .claude/commands/doh-sys/     # Development commands only âœ“
â”œâ”€â”€ todo/                         # Development task management âœ“
â”œâ”€â”€ DEVELOPMENT.md                # Internal development docs âœ“
â”œâ”€â”€ src/runtime/                  # Runtime source (for building) âœ“
â”œâ”€â”€ build/                        # Build tooling and scripts âœ“
â””â”€â”€ dist/                         # Generated runtime distributions âœ“

Generated /doh runtime distribution:
â”œâ”€â”€ .claude/commands/doh/         # Runtime commands only
â”œâ”€â”€ .claude/doh/                  # Runtime templates and docs
â”œâ”€â”€ README.md                     # User-facing documentation
â””â”€â”€ VERSION                       # Runtime version info
```

## Tasks

### Phase 1: Architecture Analysis & Planning (1h)

- [ ] **Audit current mixing** of development vs runtime components
- [ ] **Design separation strategy** for clean architectural boundaries
- [ ] **Plan migration path** for existing runtime components
- [ ] **Define build process** for generating pure runtime distributions

### Phase 2: Runtime Component Extraction (2h)

- [ ] **Move runtime commands** from `.claude/commands/doh/` to `src/runtime/commands/`
- [ ] **Relocate runtime templates** from `.claude/doh/` to `src/runtime/templates/`
- [ ] **Extract runtime documentation** to `src/runtime/docs/`
- [ ] **Create runtime-specific** configuration and metadata files

### Phase 3: Build System Refactoring (2h)

- [ ] **Refactor build scripts** to generate clean runtime distributions
- [ ] **Implement distribution packaging** that excludes development artifacts
- [ ] **Create runtime assembly** process from src/runtime/ components
- [ ] **Add distribution validation** to ensure no development leakage

### Phase 4: Testing & Validation (1h)

- [ ] **Test separated architecture** with sample runtime distribution
- [ ] **Validate clean boundaries** - no development artifacts in runtime
- [ ] **Verify build process** generates functional runtime distributions
- [ ] **Document new architecture** for future development

## Technical Implementation

### Source Organization Strategy

#### Development Project Structure

```
/doh-sys/ (pure development project):
â”œâ”€â”€ .claude/commands/doh-sys/           # Development commands
â”œâ”€â”€ src/runtime/                        # Runtime source components
â”‚   â”œâ”€â”€ commands/                       # Source for /doh commands
â”‚   â”œâ”€â”€ templates/                      # Source for DOH templates
â”‚   â”œâ”€â”€ docs/                          # Source for runtime docs
â”‚   â””â”€â”€ config/                        # Runtime configuration templates
â”œâ”€â”€ build/                              # Build tooling and scripts
â”œâ”€â”€ dist/                              # Generated distributions
â”œâ”€â”€ todo/                              # Development task management
â”œâ”€â”€ DEVELOPMENT.md                      # Development documentation
â””â”€â”€ BUILD.md                           # Build process documentation
```

#### Generated Runtime Distribution

```
doh-runtime-v1.4.0/ (clean user distribution):
â”œâ”€â”€ .claude/commands/doh/               # Runtime commands only
â”œâ”€â”€ .claude/doh/                        # Runtime templates and docs
â”œâ”€â”€ README.md                           # User installation guide
â”œâ”€â”€ WORKFLOW.md                         # User workflow documentation
â”œâ”€â”€ VERSION                             # Runtime version
â””â”€â”€ install.sh                         # Installation script
```

### Build Process Transformation

#### Current Build (Mixed)

```bash
# Current problematic approach
build-distribution.sh:
  - Copy entire project structure
  - Filter out some development files
  - Result: mixed artifacts, unclear boundaries
```

#### Target Build (Clean Separation)

```bash
# New clean separation approach
build-runtime.sh:
  1. Assemble from src/runtime/ only
  2. Generate user-facing documentation
  3. Package with installation tooling
  4. Validate zero development artifacts
  5. Create versioned distribution
```

### Migration Strategy

#### Phase A: Extract Runtime Sources

- Move `.claude/commands/doh/` â†’ `src/runtime/commands/`
- Move `.claude/doh/` â†’ `src/runtime/templates/`
- Create `src/runtime/docs/` with user-facing documentation

#### Phase B: Refactor Build System

- Update build scripts to assemble from `src/runtime/`
- Remove development artifact filtering (clean sources)
- Add distribution validation and testing

#### Phase C: Validate Separation

- Test runtime distributions work independently
- Verify no development dependencies in runtime
- Confirm build reproducibility and cleanliness

## Benefits & Impact

### Architectural Benefits

- **Clear Separation**: No confusion between development vs runtime concerns
- **Maintainability**: Easier to maintain separate development and user experiences
- **Scalability**: Can evolve development tooling without affecting runtime users
- **Professional Distribution**: Clean, focused runtime packages

### Development Benefits

- **Focused Development**: /doh-sys purely for developing DOH system
- **Cleaner Builds**: No filtering required, assemble from clean sources
- **Better Testing**: Can test runtime distributions independently
- **Version Management**: Separate versioning for development vs runtime

### User Benefits

- **Clean Installation**: Runtime distributions contain only necessary components
- **Professional Experience**: No development artifacts in user-facing packages
- **Smaller Footprint**: Runtime distributions without development overhead
- **Clear Documentation**: User-focused docs without development internals

## Success Criteria

- [ ] **Complete separation** achieved - no runtime components in development project
- [ ] **Clean build process** generates runtime distributions from src/runtime/
- [ ] **Zero development artifacts** in generated runtime distributions
- [ ] **Functional runtime** distributions work independently
- [ ] **Documentation updated** to reflect new architecture
- [ ] **Build validation** prevents development leakage into runtime

## Dependencies & Integration

- **Depends on**: DOH032 (Runtime Build Process), DOH003 (Architecture & Distribution)
- **Prepares for**: DOH Version 2.0 architectural foundation
- **Affects**: All future runtime vs development work
- **Enables**: Clean scaling of both development tooling and runtime features

## Implementation Notes

**Backward Compatibility**: This is an internal architectural change - existing runtime functionality remains identical
from user perspective.

**Development Workflow**: Developers working on /doh-sys will no longer have runtime components directly in their
project structure.

**Build Complexity**: Initial implementation increases build complexity but results in much cleaner long-term
architecture.

**Version 2.0 Preparation**: This refactoring establishes the architectural foundation for DOH 2.0's advanced features
and scaling.

## Deliverable

Completely refactored DOH build architecture with clean separation between /doh-sys development project and /doh runtime
distributions. Development project focuses purely on DOH system development while build process generates clean,
professional runtime packages with zero development artifacts.

This architectural foundation enables DOH 2.0's advanced features while providing users with clean, focused runtime
distributions and developers with maintainable, scalable development infrastructure.

---
