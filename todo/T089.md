# T089 - Perfect Linting System with Exceptions Management

**Status**: PROPOSED  
**Priority**: HIGH  
**Dependencies**: T088 (Comprehensive Auto-Correcting Linting)  
**Epic**: None

Design and implement a perfect linting system with intelligent exception handling for intentional errors, 
documentation examples, and shared functionality between scripts and hooks.

## Problem Statement

Current linting system doesn't handle:
1. **Intentional errors in documentation** (examples of what NOT to do)
2. **Inline exceptions** for specific rule violations
3. **Shared functionality** between lint script and pre-commit hooks
4. **Context-aware exceptions** (e.g., error examples in learning materials)

## Proposed Solutions

### 1. Exception Management Strategies

#### A. Inline Exceptions (Preferred)
```markdown
<!-- markdownlint-disable MD013 -->
This is a very long line that we intentionally keep long for demonstration purposes...
<!-- markdownlint-enable MD013 -->

<!-- prettier-ignore -->
This     formatting     is      intentionally      bad

<!-- codespell-ignore -->
This has a seperate error on porpose
<!-- codespell-ignore-end -->
```

#### B. File-Level Exceptions
```markdown
<!-- markdownlint-disable-file MD013 MD024 -->
<!-- prettier-ignore-file -->
```

#### C. Configuration-Based Exceptions
```json
// .markdownlint.json
{
  "ignores": ["examples/bad/*.md", "docs/errors/*.md"]
}
```

#### D. Smart Context Detection
- Detect code blocks labeled as "bad example" or "wrong"
- Skip linting in sections marked as intentional errors
- Recognize learning/tutorial contexts

### 2. Shared Linting Library Architecture

```bash
dev-tools/
├── scripts/
│   └── lint-files.sh       # Main linting script
├── lib/
│   ├── lint-core.sh        # Shared functions
│   ├── lint-prettier.sh    # Prettier wrapper (future)
│   ├── lint-markdown.sh    # Markdownlint wrapper (future)
│   └── lint-codespell.sh   # Codespell wrapper (future)
├── hooks/
│   ├── pre-commit          # Existing hook (basic)
│   └── pre-commit-new      # Enhanced hook using lib/lint-core.sh
└── linters/
    └── .markdownlint.json  # Linting configurations
```

### 3. Pre-commit Hook Integration

```bash
#!/bin/bash
# Load shared library
source "$(git rev-parse --show-toplevel)/dev-tools/lib/lint-core.sh"

# Get staged files
STAGED_FILES=$(get_staged_markdown_files)

# Run same linting pipeline
for file in $STAGED_FILES; do
    if ! lint_file "$file" --fix; then
        echo "❌ Linting failed. Commit blocked."
        echo "Run: make lint-staged"
        exit 1
    fi
done
```

### 4. Exception Patterns Implementation

#### Pattern 1: Documentation Examples
```markdown
## Common Mistakes to Avoid

<!-- lint-example:bad -->
```javascript
// ❌ BAD: Don't do this
function   badFormatting(  ){
    console.log("This is intentionally bad")
}
```
<!-- lint-example:end -->

<!-- lint-example:good -->
```javascript
// ✅ GOOD: Do this instead
function goodFormatting() {
    console.log("This is properly formatted");
}
```
<!-- lint-example:end -->
```

#### Pattern 2: Teaching Materials
```markdown
<!-- teaching-mode -->
### Exercise: Fix These Errors

The following has intentional errors:
- seperate (should be separate)
- occured (should be occurred)
<!-- teaching-mode:end -->
```

#### Pattern 3: Historical Preservation
```markdown
<!-- preserve-original -->
This section maintains original formatting from legacy documentation
<!-- preserve-original:end -->
```

### 5. Implementation Tasks

- [x] Create `dev-tools/lib/lint-core.sh` with shared functions
- [x] Move linting scripts to `dev-tools/` structure
- [x] Create enhanced pre-commit hook using shared library
- [x] Maintain compatibility with existing `dev-tools/hooks/pre-commit`
- [ ] Implement inline exception parsing
- [ ] Add context-aware detection for examples
- [ ] Document exception patterns in CONTRIBUTING.md
- [ ] Add exception validation (ensure exceptions are closed)
- [ ] Implement reporting for skipped sections
- [ ] Add tests for exception handling
- [ ] Update Makefile to use new dev-tools paths

### 6. Configuration Schema

```json
{
  "linting": {
    "exceptions": {
      "inline": true,
      "patterns": {
        "bad-example": "lint-example:bad",
        "teaching": "teaching-mode",
        "preserve": "preserve-original"
      },
      "files": {
        "ignore": ["examples/errors/**"],
        "skip-patterns": ["**/bad-*.md"]
      }
    },
    "reporting": {
      "show-skipped": true,
      "verbose": false
    }
  }
}
```

### 7. Usage Examples

```bash
# Lint with exception handling
./dev-tools/scripts/lint-files.sh --with-exceptions README.md

# Report what was skipped
./dev-tools/scripts/lint-files.sh --show-skipped todo/

# Validate exception tags are properly closed
./dev-tools/scripts/lint-files.sh --validate-exceptions

# Use via Makefile (recommended)
make lint-file FILE=README.md
make lint-staged

# Pre-commit hook options:
# Option 1: Use existing basic hook (dev-tools/hooks/pre-commit)
# Option 2: Use enhanced hook (dev-tools/hooks/pre-commit-new)
ln -sf ../../dev-tools/hooks/pre-commit-new .git/hooks/pre-commit
```

## Success Criteria

- ✅ Can mark intentional errors without triggering linting
- ✅ Shared code between script and hooks (DRY)
- ✅ Clear exception patterns for different use cases
- ✅ No false positives on documentation examples
- ✅ Maintain 100% linting coverage outside exceptions
- ✅ Clear reporting of what was skipped and why
- ✅ Easy to add/remove exceptions
- ✅ Git hooks use exact same rules as manual linting

## Deliverable

A complete linting system that intelligently handles exceptions while maintaining code quality, 
with shared functionality between all linting entry points.